<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Lenny的博客</title>
  
  <subtitle>所谓成功，就是不断的经历失败，并且始终保持热情。——丘吉尔</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://lennyup.github.io/"/>
  <updated>2017-10-11T09:15:52.000Z</updated>
  <id>https://lennyup.github.io/</id>
  
  <author>
    <name>Lenny</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>android需要的Java基础（复习篇）</title>
    <link href="https://lennyup.github.io/2017/09/22/android-java/"/>
    <id>https://lennyup.github.io/2017/09/22/android-java/</id>
    <published>2017-09-22T03:21:17.000Z</published>
    <updated>2017-10-11T09:15:52.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><p>这段时间，项目基本完成，进入测试上线阶段，终于可以闲下来查漏补缺了，这里我将复习下android所需要的java基础，也可以帮大家回忆一下，今年的Google IO 大会上，Google宣布Kotlin成为Android的官方语言，有兴趣的可以去学习下，Java作为android的第一个语言，还是需要把打这部分知识打牢固的。(这部分内容只是当作自己的复习)<br><a id="more"></a></p><h3 id="1、三大特性"><a href="#1、三大特性" class="headerlink" title="1、三大特性"></a>1、三大特性</h3><p>Java做为面向对象的语言，他的三大特性：<code>继承</code>、<code>封装</code>、<code>多态</code>。</p><h3 id="2、6大原则"><a href="#2、6大原则" class="headerlink" title="2、6大原则"></a>2、6大原则</h3><h5 id="单一职责原则（Single-Responsibility-Principle）"><a href="#单一职责原则（Single-Responsibility-Principle）" class="headerlink" title="单一职责原则（Single Responsibility Principle）"></a>单一职责原则（Single Responsibility Principle）</h5><p>定义： 不要存在多于一个导致类变更的原因。也就是说，一个类只负责一项职责</p><p>案例：工厂A负责生产面包和牛奶，当生产面包的需求发生变化时，需要改变工厂生产模式，这事就有可能影响牛奶的生产。</p><p>解决方案：遵循单一职责原则，分别建立两个子公司，一个负责生产面包，一个负责生产牛奶，这样如果面包需求变了就不会影响牛奶的生产了。</p><p>例子：</p><figure class="highlight cs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Factory</span> &#123;</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="title">Factory</span> (<span class="params"></span>) </span>&#123;</div><div class="line">super();</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">product</span>(<span class="params"></span>) </span>&#123;</div><div class="line">System.<span class="keyword">out</span>.println(“生产饼干”)；</div><div class="line">System.<span class="keyword">out</span>.println(“生产葡萄干”);</div><div class="line">&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><figure class="highlight cs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Main</span> &#123;</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span> (<span class="params">String [] args</span>) </span>&#123;</div><div class="line"><span class="keyword">new</span> Factory.product();</div><div class="line">&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>遵循单一职责原则，做如下修改：</p><figure class="highlight cs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">FactoryA</span> &#123;</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">product</span>(<span class="params"></span>) </span>&#123;</div><div class="line">System.<span class="keyword">out</span>.println(“生产饼干”);</div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">FactoryB</span> &#123;</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">product</span>(<span class="params"></span>) </span>&#123;</div><div class="line">System.<span class="keyword">out</span>.println(“生产葡萄干”);</div><div class="line">&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Factory</span> </span>&#123;</div><div class="line"><span class="keyword">private</span> FactoryA mA;</div><div class="line"><span class="keyword">private</span> FactoryB mB;</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="title">Factory</span> <span class="params">()</span> </span>&#123;</div><div class="line"><span class="keyword">super</span>();</div><div class="line">mA = <span class="keyword">new</span> FactoryA();</div><div class="line">mB = <span class="keyword">new</span> FactoryB();</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">product</span><span class="params">()</span> </span>&#123;</div><div class="line">mA.product();</div><div class="line">mB.product();</div><div class="line">&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>我理解的单一职责原则就是在开发过程中尽量将一些类的职责明确、唯一。</p><p>遵循单一职责的优点：</p><ul><li>降低复杂度</li><li>提高可读性</li><li>降低对其他功能的影响</li></ul><p>可是可能由于职责的颗粒化，我们往往会违背这个原则，这个原因为职责扩散（就是因为某些原因，我们要吧职责之一再次细分）<br>关于这部分请看 <a href="http://blog.csdn.net/zhengzhb/article/details/7278174" target="_blank" rel="external">单一职责原则（1）</a></p><h5 id="里氏替换原则-（Liskov-Substitutiion-Principle）"><a href="#里氏替换原则-（Liskov-Substitutiion-Principle）" class="headerlink" title="里氏替换原则 （Liskov Substitutiion Principle）"></a>里氏替换原则 （Liskov Substitutiion Principle）</h5><p>定义：所有引用基类的地方必须能够透明地使用其子类的对象</p><p>通俗的说，就是用父类的地方可以用子类去代替，但是用子类的地方用父类不一定能代替。</p><p>里氏替换原则包含4层含义：</p><ol><li>子类必须完全实现父类的方法</li><li>子类可以有自己的方法</li><li>当子类的方法重载父类的方法时，形参要比父类的范围更大</li><li>当子类的方法实现父类的抽象方法时，方法的返回值要比父类更严格</li></ol><p>例子：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String [] args)</span> </span>&#123;</div><div class="line">Man m = <span class="keyword">new</span> Man();</div><div class="line"></div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Cat</span> </span>&#123;</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">eat</span><span class="params">()</span></span>&#123;&#125;</div><div class="line">&#125;</div><div class="line"><span class="comment">/**</span></div><div class="line">* 人可以喂猫吃东西，可以有不同种类的猫</div><div class="line">*/</div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Man</span> </span>&#123;</div><div class="line"><span class="keyword">private</span> Cat mCat;</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCat</span><span class="params">(Cat mCat)</span> </span>&#123;</div><div class="line"><span class="keyword">this</span>.mCat = mCat;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">feed</span><span class="params">()</span> </span>&#123;</div><div class="line">mCat.eat();</div><div class="line">System.out.println(<span class="string">"正在进食..."</span>);</div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Garfield</span> <span class="keyword">extends</span> <span class="title">Cat</span> </span>&#123;</div><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">eat</span><span class="params">()</span> </span>&#123;</div><div class="line">System.out.println(<span class="string">"加菲猫进食..."</span>);</div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Folds</span> <span class="keyword">extends</span> <span class="title">Cat</span> </span>&#123;</div><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">eat</span><span class="params">()</span> </span>&#123;</div><div class="line">System.out.println(<span class="string">"折耳猫进食..."</span>);</div><div class="line">&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>优点： 可以对后期版本升级，增添子类时都可以很好的维护</p><h5 id="依赖倒置原则（Dependence-Inversion-Principle）"><a href="#依赖倒置原则（Dependence-Inversion-Principle）" class="headerlink" title="依赖倒置原则（Dependence Inversion Principle）"></a>依赖倒置原则（Dependence Inversion Principle）</h5><p>定义： 高层模块不应该依赖底层模块，应该依赖其抽象，抽象不应该依赖其细节，细节应该依赖其抽象。</p><p>底层模块：负责基本的操作</p><p>高层模块：由多个底层模块组成，负责复杂的操作</p><p>抽象：在Java中指的是接口或者抽象类</p><p>依赖倒置的核心思想是面向接口编程，相对于细节的多变性，抽象的稳定性更高一些。以抽象为基础搭建起来的架构比以细节搭建起来的框架稳定的多。下面我们用例子来解释下依赖倒置原则。</p><figure class="highlight cs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">class</span> <span class="title">Bread</span> &#123;</div><div class="line"><span class="function"><span class="keyword">public</span> String <span class="title">getContent</span> (<span class="params"></span>) </span>&#123;</div><div class="line"><span class="keyword">return</span> <span class="string">"面包生产出来了"</span></div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">class</span> <span class="title">Factory</span> &#123;</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">poduct</span>(<span class="params">Bread bread</span>) </span>&#123;</div><div class="line">System.<span class="keyword">out</span>.println(<span class="string">"工厂开始生产"</span>);  </div><div class="line">       System.<span class="keyword">out</span>.println(book.getContent());</div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Test</span> &#123;</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span>(<span class="params">String [] args</span>) </span>&#123;</div><div class="line">Factory mFactory = <span class="keyword">new</span> Factory();</div><div class="line">mFactory.poduct(<span class="keyword">new</span> Bread());</div><div class="line">&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>假如现在需求变了，不再生产面包，改为生产牛奶，这个时候工厂是做不了的，它只能生产面包。这样的话耦合性就会很高了。</p><p>遵循以来倒置的原则，我们做如下修改：</p><figure class="highlight cs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">interface</span> <span class="title">Model</span> &#123;</div><div class="line"><span class="function"><span class="keyword">public</span> String <span class="title">getContent</span>(<span class="params"></span>)</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure><figure class="highlight haxe"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">NewBread</span> <span class="keyword"><span class="keyword">implements</span> <span class="type">Model</span></span> </span>&#123;</div><div class="line"><span class="keyword">public</span> <span class="keyword">String</span> getContent() &#123;</div><div class="line"><span class="keyword">return</span> <span class="string">"面包生产出来了"</span></div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Milk</span> <span class="keyword"><span class="keyword">implements</span> <span class="type">Model</span></span> </span>&#123;</div><div class="line"><span class="keyword">public</span> <span class="keyword">String</span> getContent() &#123;</div><div class="line"><span class="keyword">return</span> <span class="string">"牛奶生产出来了"</span></div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Factory</span> </span>&#123;</div><div class="line"><span class="keyword">public</span> void product(Model model) &#123;</div><div class="line">System.out.println(<span class="string">"工厂开始生产"</span>)</div><div class="line">System.out.println(model.getContent());</div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</div><div class="line"><span class="keyword">public</span> <span class="keyword">static</span> void main(<span class="keyword">String</span> [] args) &#123;</div><div class="line">Factory mFactory = <span class="keyword">new</span> <span class="type">Factory</span>();</div><div class="line">mFactory.product(<span class="keyword">new</span> <span class="type">NewBread</span>());</div><div class="line">mFactory.product(<span class="keyword">new</span> <span class="type">Milk</span>())</div><div class="line">&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>依赖有三种写法</p><h6 id="1、构造函数传递依赖"><a href="#1、构造函数传递依赖" class="headerlink" title="1、构造函数传递依赖"></a>1、构造函数传递依赖</h6><figure class="highlight cs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">class</span> <span class="title">Factory</span> &#123;</div><div class="line"><span class="function"><span class="keyword">private</span> Model model</span></div><div class="line"><span class="keyword">public</span> <span class="title">Factory</span>(<span class="params">Model model</span>) &#123;</div><div class="line"><span class="keyword">this</span>.model = model;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">product</span> (<span class="params"></span>) </span>&#123;</div><div class="line">System.<span class="keyword">out</span>.println(<span class="string">"工厂开始生产"</span>)</div><div class="line">System.<span class="keyword">out</span>.println(model.getContent());</div><div class="line">&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><h6 id="2、setter方法传递"><a href="#2、setter方法传递" class="headerlink" title="2、setter方法传递"></a>2、setter方法传递</h6><figure class="highlight cs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">class</span> <span class="title">Factory</span> &#123;</div><div class="line"><span class="function"><span class="keyword">private</span> Model model</span></div><div class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setModel</span>(<span class="params">Model model</span>) &#123;</div><div class="line"><span class="keyword">this</span>.model = model;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">product</span> (<span class="params"></span>) </span>&#123;</div><div class="line">System.<span class="keyword">out</span>.println(<span class="string">"工厂开始生产"</span>)</div><div class="line">System.<span class="keyword">out</span>.println(model.getContent());</div><div class="line">&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><h6 id="3、接口传递依赖"><a href="#3、接口传递依赖" class="headerlink" title="3、接口传递依赖"></a>3、接口传递依赖</h6><p>如 最开始给的例子</p><h5 id="接口隔离原则-（Interface-segregation-Principle）"><a href="#接口隔离原则-（Interface-segregation-Principle）" class="headerlink" title="接口隔离原则 （Interface segregation Principle）"></a>接口隔离原则 （Interface segregation Principle）</h5><p>定义：客户端不应该依赖它不需要的接口，类间的依赖关系应该建立在最小的接口上。</p><p>我们用一个例子来说明下：</p><figure class="highlight cs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">interface</span> <span class="title">I</span> &#123;</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">m1</span>(<span class="params"></span>)</span>;</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">m2</span>(<span class="params"></span>)</span>;</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">m3</span>(<span class="params"></span>)</span>;</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">m4</span>(<span class="params"></span>)</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">class</span> <span class="title">B</span> <span class="title">implements</span> <span class="title">I</span> &#123;</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">m1</span>(<span class="params"></span>) </span>&#123;</div><div class="line">System.<span class="keyword">out</span>.println(<span class="string">"类B实现接口I的方法1"</span>);</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">m2</span>(<span class="params"></span>) </span>&#123;</div><div class="line">System.<span class="keyword">out</span>.println(<span class="string">"类B实现接口I的方法2"</span>);</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">m3</span>(<span class="params"></span>)</span>&#123;&#125;</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">m4</span>(<span class="params"></span>)</span>&#123;&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">class</span> <span class="title">A</span> &#123;</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">depend1</span>(<span class="params">I i</span>) </span>&#123;</div><div class="line">i.m1();</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">depend2</span>(<span class="params">I i</span>) </span>&#123;</div><div class="line">i.m2();</div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">class</span> <span class="title">C</span> &#123;</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">depend1</span>(<span class="params">I i</span>) </span>&#123;</div><div class="line">i.m3();</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">depend2</span>(<span class="params">I i</span>) </span>&#123;</div><div class="line">i.m4();</div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">class</span> <span class="title">D</span> <span class="title">implements</span> <span class="title">I</span> &#123;</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">m1</span>(<span class="params"></span>) </span>&#123;</div><div class="line"></div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">m2</span>(<span class="params"></span>) </span>&#123;</div><div class="line"></div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">m3</span>(<span class="params"></span>)</span>&#123;</div><div class="line">System.<span class="keyword">out</span>.println(<span class="string">"类D实现接口I的方法3"</span>);</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">m4</span>(<span class="params"></span>)</span>&#123;</div><div class="line">System.<span class="keyword">out</span>.println(<span class="string">"类D实现接口I的方法4"</span>);</div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Client</span> &#123;</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span>(<span class="params">String [] args</span>) </span>&#123;</div><div class="line">  A a = <span class="keyword">new</span> A();  </div><div class="line">        a.depend1(<span class="keyword">new</span> B());  </div><div class="line">        a.depend2(<span class="keyword">new</span> B());            </div><div class="line">        C c = <span class="keyword">new</span> C();  </div><div class="line">        c.depend1(<span class="keyword">new</span> D());  </div><div class="line">        c.depend2(<span class="keyword">new</span> D());</div><div class="line">&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>可以看到，对了类B来说 方法3和方法4是不需要的，但是由于接口I中有这两个方法，所以必须实现它。同理，对于类D来说，方法1和方法2是不需要的。这样的话就不符合接口隔离原则，下面我们修改一下以符合其原则：</p><figure class="highlight cs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">interface</span> <span class="title">I</span> &#123;</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">m1</span>(<span class="params"></span>)</span>;</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">m2</span>(<span class="params"></span>)</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">interface</span> <span class="title">I1</span> &#123;</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">m3</span>(<span class="params"></span>)</span>;</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">m4</span>(<span class="params"></span>)</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">class</span> <span class="title">B</span> <span class="title">implements</span> <span class="title">I</span> &#123;</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">m1</span>(<span class="params"></span>) </span>&#123;</div><div class="line">System.<span class="keyword">out</span>.println(<span class="string">"类B实现接口I的方法1"</span>);</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">m2</span>(<span class="params"></span>) </span>&#123;</div><div class="line">System.<span class="keyword">out</span>.println(<span class="string">"类B实现接口I的方法2"</span>);</div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">class</span> <span class="title">A</span> &#123;</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">depend1</span>(<span class="params">I i</span>) </span>&#123;</div><div class="line">i.m1();</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">depend2</span>(<span class="params">I i</span>) </span>&#123;</div><div class="line">i.m2();</div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">class</span> <span class="title">C</span> &#123;</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">depend1</span>(<span class="params">I1 i</span>) </span>&#123;</div><div class="line">i.m3();</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">depend2</span>(<span class="params">I1 i</span>) </span>&#123;</div><div class="line">i.m4();</div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">class</span> <span class="title">D</span> <span class="title">implements</span> <span class="title">I1</span> &#123;</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">m3</span>(<span class="params"></span>)</span>&#123;</div><div class="line">System.<span class="keyword">out</span>.println(<span class="string">"类D实现接口I的方法3"</span>);</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">m4</span>(<span class="params"></span>)</span>&#123;</div><div class="line">System.<span class="keyword">out</span>.println(<span class="string">"类D实现接口I的方法4"</span>);</div><div class="line">&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>我理解的接口隔离原则是：建立单一的接口，尽量接口细化，不要建立臃肿的接口，接口中的方法尽量少。</p><p>接口隔离原则是对接口进行的规范约束，应该要主要一下几点（摘自《设计模式之禅》）</p><ul><li>接口尽量小</li></ul><p>接口在遵循单一职责原则的情况下，尽量减少和接口中方法，不不是无休止的细化接口。</p><ul><li>高内聚</li></ul><p>高内聚是提高接口、类、模块的处理能力，减少对外的交互。在接口中尽量少公布public方法，接口是对外的承诺，承诺越少对外越有利，变更的风险也就越少，同时有利于降低成本</p><ul><li>定制服务</li></ul><p>根据需求分析，必要时为特殊用户提供定制的接口，尽量避免不同操作人群使用同一接口，这样会降低系统的享用速度和扩展性。</p><ul><li>接口设计是有限度的</li></ul><p>根据开发情景划分设计接口，在开发过程中接口设计的颗粒度越小，系统灵活性越高。并不是以为的将接口细化。</p><h4 id="迪米特法则（Low-of-Demeter-LoD）"><a href="#迪米特法则（Low-of-Demeter-LoD）" class="headerlink" title="迪米特法则（Low of Demeter,LoD）"></a>迪米特法则（Low of Demeter,LoD）</h4><p><code>定义</code>：一个对象应该对其他对象有最少的了解，只与直接的朋友通信。</p><p><code>朋友关系</code>：每个对象都必然会与其他对象有耦合关系，两个对象之间的耦合关系就称为朋友关系。</p><p>迪米特法则定义的是类之间的关系要低耦合，一个类中的朋友不要太多，这样后期维护起来比较方便。</p><p>举个例子：老师清点人数，老师通过班长清点人数。</p><figure class="highlight cs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Teacher</span> &#123;</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">command</span> (<span class="params">ClassMonitor classMonitor</span>) </span>&#123;</div><div class="line">List&lt;Student&gt; list = <span class="keyword">new</span> ArrayList&lt;Student&gt;();</div><div class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">20</span>;i++) &#123;</div><div class="line">list.<span class="keyword">add</span>(<span class="keyword">new</span> Student());</div><div class="line">&#125;</div><div class="line">classMonitor.count(list)</div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">class</span> <span class="title">ClassMonitor</span> &#123;</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">count</span>(<span class="params">List&lt;Student&gt; list</span>) </span>&#123;</div><div class="line">System.<span class="keyword">out</span>.println(<span class="string">"班长说：全班的人数是。。。"</span>+list.size());</div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">class</span> <span class="title">Student</span> &#123;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Test</span> &#123;</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span>(<span class="params">String [] args</span>) </span>&#123;</div><div class="line"><span class="keyword">new</span> Teacher().command(<span class="keyword">new</span> ClassMonitor());</div><div class="line">&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>在Teacher类中，一个方法调用的两个类的实例，分别是ClassMonitor和Student类。对于Teacher类来说，朋友类只有ClassMonitor，迪米特法则告诉我们只与朋友类通信，所以这种设计就违反了迪米特法则。</p><p>在Java中朋友的定义为：出现在成员变量。方法的输入输出类称为朋友类，在方法体内的类不属于朋友类</p><p>我们改进一下，以复合迪米特法则</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">class</span> Teacher &#123;</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">command</span> <span class="params">(ClassMonitor classMonitor)</span> </span>&#123;</div><div class="line">classMonitor.count();</div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">class</span> ClassMonitor &#123;</div><div class="line">List&lt;Student&gt; <span class="built_in">list</span>;</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="title">ClassMonitor</span><span class="params">(List&lt;Student&gt; <span class="built_in">list</span>)</span> </span>&#123;</div><div class="line"><span class="keyword">this</span>.<span class="built_in">list</span> = <span class="built_in">list</span>;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">count</span><span class="params">(List&lt;Student&gt; <span class="built_in">list</span>)</span> </span>&#123;</div><div class="line">System.out.println(<span class="string">"班长说：全班的人数是。。。"</span>+<span class="built_in">list</span>.size());</div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">class</span> Student &#123;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="keyword">class</span> Test &#123;</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String [] args)</span> </span>&#123;</div><div class="line">List&lt;Student&gt; <span class="built_in">list</span> = <span class="keyword">new</span> ArrayList&lt;Student&gt;();</div><div class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">20</span>;i++) &#123;</div><div class="line"><span class="built_in">list</span>.add(<span class="keyword">new</span> Student());</div><div class="line">&#125;</div><div class="line"><span class="keyword">new</span> Teacher().command(<span class="keyword">new</span> ClassMonitor(<span class="built_in">list</span>));</div><div class="line">&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>迪米特法则给类的低耦合提出了四个基本要求</p><h6 id="1-只和朋友类交流"><a href="#1-只和朋友类交流" class="headerlink" title="1. 只和朋友类交流"></a>1. 只和朋友类交流</h6><h6 id="2-朋友间也是有距离的"><a href="#2-朋友间也是有距离的" class="headerlink" title="2. 朋友间也是有距离的"></a>2. 朋友间也是有距离的</h6><pre><code>在java中的实现思想就是：类A与类B之间有依赖关系，并在方法输入或输出中创建该类的实例，那么他们属于朋友类，但是类A不可以过分操作类B的方法</code></pre><h6 id="3-是自己的就是自己的"><a href="#3-是自己的就是自己的" class="headerlink" title="3. 是自己的就是自己的"></a>3. 是自己的就是自己的</h6><pre><code>如果一个方法放在本类中，既不增加类间关系，也对本类不产生负面影响，那就放置在本类中</code></pre><h6 id="4-谨慎使用serializable"><a href="#4-谨慎使用serializable" class="headerlink" title="4. 谨慎使用serializable"></a>4. 谨慎使用serializable</h6><h4 id="开闭原则（Open-Closed-Principle，OCP）"><a href="#开闭原则（Open-Closed-Principle，OCP）" class="headerlink" title="开闭原则（Open Closed Principle，OCP）"></a>开闭原则（Open Closed Principle，OCP）</h4><p>定义：一个软件实体如类、模块和函数应该对扩展开发，对修改关闭。即软件实体应尽量在不修改原有代码的情况下进行扩展。</p><p>软件实体包括：</p><ul><li>项目或软件产品中按照一定的逻辑规则划分的模块</li><li>抽象和类</li><li>方法</li></ul><p>一个实例</p><ul><li>IMilk 定义了两个属性：厂商和价格</li><li>Supermarket是超市</li><li>NovelMilk是一个具体的实现类</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Supermarket</span> </span>&#123;</div><div class="line"><span class="keyword">public</span> <span class="keyword">static</span> List&lt;NovelMilk&gt; list = <span class="keyword">new</span> ArrayList&lt;NovelMilk&gt;();</div><div class="line"><span class="keyword">static</span> &#123;</div><div class="line">list.add(<span class="keyword">new</span> NovelMilk(<span class="string">"伊利"</span>, <span class="number">60</span>))</div><div class="line">list.add(<span class="keyword">new</span> NovelMilk(<span class="string">"安慕希"</span>,<span class="number">55</span>))</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String [] args)</span> </span>&#123;</div><div class="line"><span class="keyword">for</span>(NovelMilk milk: list) &#123;</div><div class="line">System.out.println(<span class="string">"牛奶厂商"</span> + milk.getManufacturers()+<span class="string">"\t 价格："</span>+ milk.getPrice()+ <span class="string">"元"</span>)</div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">interface</span> <span class="title">IMilk</span> </span>&#123;</div><div class="line"><span class="function"><span class="keyword">public</span> String <span class="title">getManufacturers</span><span class="params">()</span></span>;</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getPrice</span><span class="params">()</span></span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">NovelMilk</span> <span class="keyword">implements</span> <span class="title">IMilk</span> </span>&#123;</div><div class="line"><span class="keyword">private</span> <span class="keyword">int</span> price;</div><div class="line"><span class="keyword">private</span> String manufacturers;</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="title">NovelMilk</span><span class="params">(String manufacturers, <span class="keyword">int</span> price)</span> </span>&#123;</div><div class="line"><span class="keyword">this</span>.manufacturers = manufacturers;</div><div class="line"><span class="keyword">this</span>.price = price;</div><div class="line">&#125;</div><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getPrice</span><span class="params">()</span> </span>&#123;</div><div class="line"><span class="comment">// TODO Auto-generated method stub</span></div><div class="line"><span class="keyword">return</span> <span class="keyword">this</span>.price;</div><div class="line">&#125;</div><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">public</span> String <span class="title">getManufacturers</span><span class="params">()</span> </span>&#123;</div><div class="line"><span class="comment">// TODO Auto-generated method stub</span></div><div class="line"><span class="keyword">return</span> <span class="keyword">this</span>.manufacturers;</div><div class="line">&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>需求更改：超市进行打折促销，规定 50元以下的 9折出售。</p><p>如果要在NovelMilk中修改的话，修改量就会很大，而且违背了开闭原则，<br>解决方案：通过扩展实现变化</p> <figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div></pre></td><td class="code"><pre><div class="line"> <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Supermarket</span> </span>&#123;</div><div class="line"><span class="keyword">public</span> <span class="keyword">static</span> List&lt;NovelMilk&gt; list = <span class="keyword">new</span> ArrayList&lt;NovelMilk&gt;();</div><div class="line"><span class="keyword">static</span> &#123;</div><div class="line">list.add(<span class="keyword">new</span> OffNovelMilk(<span class="string">"伊利"</span>, <span class="number">60</span>))</div><div class="line">list.add(<span class="keyword">new</span> OffNovelMilk(<span class="string">"安慕希"</span>,<span class="number">55</span>))</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String [] args)</span> </span>&#123;</div><div class="line"><span class="keyword">for</span>(NovelMilk milk: list) &#123;</div><div class="line">System.out.println(<span class="string">"牛奶厂商"</span> + milk.getManufacturers()+<span class="string">"\t 价格："</span>+ milk.getPrice()+ <span class="string">"元"</span>)</div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">interface</span> <span class="title">IMilk</span> </span>&#123;</div><div class="line"><span class="function"><span class="keyword">public</span> String <span class="title">getManufacturers</span><span class="params">()</span></span>;</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getPrice</span><span class="params">()</span></span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">NovelMilk</span> <span class="keyword">implements</span> <span class="title">IMilk</span> </span>&#123;</div><div class="line"><span class="keyword">private</span> <span class="keyword">int</span> price;</div><div class="line"><span class="keyword">private</span> String manufacturers;</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="title">NovelMilk</span><span class="params">(String manufacturers, <span class="keyword">int</span> price)</span> </span>&#123;</div><div class="line"><span class="keyword">this</span>.manufacturers = manufacturers;</div><div class="line"><span class="keyword">this</span>.price = price;</div><div class="line">&#125;</div><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getPrice</span><span class="params">()</span> </span>&#123;</div><div class="line"><span class="comment">// TODO Auto-generated method stub</span></div><div class="line"><span class="keyword">return</span> <span class="keyword">this</span>.price;</div><div class="line">&#125;</div><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">public</span> String <span class="title">getManufacturers</span><span class="params">()</span> </span>&#123;</div><div class="line"><span class="comment">// TODO Auto-generated method stub</span></div><div class="line"><span class="keyword">return</span> <span class="keyword">this</span>.manufacturers;</div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">OffNovelMilk</span> <span class="keyword">extends</span> <span class="title">NovelMilk</span></span>&#123;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="title">OffNovelMilk</span><span class="params">(String manufacturers, <span class="keyword">int</span> price)</span> </span>&#123;</div><div class="line"><span class="keyword">super</span>(manufacturers, price);</div><div class="line"><span class="comment">// TODO Auto-generated constructor stub</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getPrice</span><span class="params">()</span> </span>&#123;</div><div class="line"><span class="keyword">int</span> rePrice = <span class="keyword">super</span>.getPrice();</div><div class="line"><span class="keyword">int</span> nowPrice = <span class="number">0</span>;</div><div class="line"><span class="keyword">if</span>(rePrice&lt;<span class="number">50</span>)&#123;</div><div class="line">nowPrice = rePrice*<span class="number">90</span>/<span class="number">100</span>;</div><div class="line">&#125;<span class="keyword">else</span>&#123;</div><div class="line">nowPrice = rePrice;</div><div class="line">&#125;</div><div class="line"><span class="keyword">return</span> nowPrice;</div><div class="line">&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;前言&quot;&gt;&lt;a href=&quot;#前言&quot; class=&quot;headerlink&quot; title=&quot;前言&quot;&gt;&lt;/a&gt;前言&lt;/h3&gt;&lt;p&gt;这段时间，项目基本完成，进入测试上线阶段，终于可以闲下来查漏补缺了，这里我将复习下android所需要的java基础，也可以帮大家回忆一下，今年的Google IO 大会上，Google宣布Kotlin成为Android的官方语言，有兴趣的可以去学习下，Java作为android的第一个语言，还是需要把打这部分知识打牢固的。(这部分内容只是当作自己的复习)&lt;br&gt;
    
    </summary>
    
    
      <category term="Java" scheme="https://lennyup.github.io/tags/Java/"/>
    
  </entry>
  
  <entry>
    <title>android面试题以及一些贮备知识</title>
    <link href="https://lennyup.github.io/2017/09/20/android-interview/"/>
    <id>https://lennyup.github.io/2017/09/20/android-interview/</id>
    <published>2017-09-20T03:20:42.000Z</published>
    <updated>2017-10-11T06:14:30.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><p>这段时间，掘金出了个掘金秋招求职征文大赛，好想参加，但是自己貌似已经一年多没有参加过面试了（似的，我变懒了，这是不对的 ps： 捂脸哭），看见好多大佬的文章，感觉自己没有学过Android了，是时候把自己以前遗落的再次捡起来了，这里只是提供一些面试题和一些基础的知识，可能会不全，甚至会有错误（清喷），我会不定时更新的。<br><a id="more"></a></p><h3 id="Android核心"><a href="#Android核心" class="headerlink" title="Android核心"></a>Android核心</h3><h4 id="ANR"><a href="#ANR" class="headerlink" title="ANR"></a>ANR</h4><p><img src="https://raw.githubusercontent.com/lennyup/img-warehouse/master/anr-issue.png" alt=""></p><p>解答：在Android上，如果你的应用程序有一段时间响应不够灵敏，系统会向用户显示一个对话框，这个对话框称作无响应（ANR： Appplication Not Responding）对话框。<br>默认情况下，在android中的Activity最长执行时间是5秒，BroadcastReceiver的最长之行事件则是10秒。超出就会提示无响应对话框。</p><p>三种常见类型</p><ul><li><p>KeyDispathTimeout(5 seconds) –主要类型</p>  <font color="#A9A9A9" face="黑体">按键或触摸事件在特定时间内无响应</font></li><li><p>BroadcastTimeout(10 seconds)</p>  <font color="#A9A9A9" face="黑体">BroadcastReceiver在特定时间内无法处理完成</font></li><li><p>SeriviceTimeout(20 seconds) –小概率类型</p>  <font color="#A9A9A9" face="黑体">Service在特定的时间内无法处理完成</font></li></ul><h4 id="Activity生命周期"><a href="#Activity生命周期" class="headerlink" title="Activity生命周期"></a>Activity生命周期</h4><p><img src="https://raw.githubusercontent.com/lennyup/img-warehouse/master/activity-life.png" alt=""></p><p>解答： 答案是 B C</p><p>对于A，正确的应该是<br><code>在AndroidManifest.xml中设置 android:configChanges=&quot;orientation|screenSize&quot;，切屏不会重新调用各个生命周期，只会执行onConfigurationChanged方法</code></p><p>对于D，正在操作的应用属于 前台进程，当内存不足的时候，也不会被杀死的</p><h4 id="Service"><a href="#Service" class="headerlink" title="Service"></a>Service</h4><p>1、<img src="https://raw.githubusercontent.com/lennyup/img-warehouse/master/service1.png" alt=""></p><p>解答： bindService是异步调用和Service进行绑定，如果绑定成功，则会调用ServiceConnection的onServiceConnectes当调用bindService方法后就会回调Activity的onServiceConnected，在这个方法中会向Activity中传递一个IBinder的实例，Activity需要保存这个实例。</p><p>2、<img src="https://raw.githubusercontent.com/lennyup/img-warehouse/master/service2.png" alt=""></p><p>解答：AD<br><img src="https://uploadfiles.nowcoder.com/images/20161103/7327747_1478142515011_5191CAD3158E038AE9D09ED7CF1D5165" alt=""></p><h4 id="Intent"><a href="#Intent" class="headerlink" title="Intent"></a>Intent</h4><p><img src="https://raw.githubusercontent.com/lennyup/img-warehouse/master/intent-issues.png" alt=""></p><p>解答： ABCD</p><ul><li>Serializable: 将Java对象序列化为二进制文件的Java序列化技术中一个较为重要的技术点，在大部分情况下，开发人员只需要实现Serializable 接口，使用ObjecInputStream和ObjectOutputStream进行对象的读写。</li><li>Charsequence 在JDK1.4中，引入CharSequence接口，实现这个接口的类有：CharBuffer、String、StringBuffer这四个类。</li><li>Parcelable：android提供了一种新的类型：Parcel。本类被用作封装数据的容器，封装后的数据可以通过Intent或IPC传递。除了基本类型意外，只有实现了Parcelable接口的类才能被放入Parcel中。</li><li>Bundle：Bundle是将数据传递到另一个上下文中或保存或回复你自己状态的数据存储方式。它的数据不是持久化状态。</li></ul><h4 id="NDK"><a href="#NDK" class="headerlink" title="NDK"></a>NDK</h4><p><img src="https://raw.githubusercontent.com/lennyup/img-warehouse/master/ndk.png" alt=""></p><p>解答： ABCD</p><p><a href="http://www.cnblogs.com/devinzhang/archive/2012/02/29/2373729.html" target="_blank" rel="external">Android之NDK开发</a></p><h4 id="资源池"><a href="#资源池" class="headerlink" title="资源池"></a>资源池</h4><p> <img src="https://raw.githubusercontent.com/lennyup/img-warehouse/master/resouce.png" alt=""></p><p> 解答：<br>A.Message提供了消息池，有静态方法Obtain从消息池中取对象；<br>B.Thread默认不提供资源池，除非使用线程池ThreadPool管理；<br>C.AsynTask是线程池改造的，池里 默认提供（核数+1）个线程进行并发操作，最大支持（核数  * 2 + 1）个线程，超过后会丢弃其他任务；<br>D.Looper，每个Looper创建时创建一个消息队列和线程对象，也不是资源池；<br>因此答案为AC</p><h4 id="Style"><a href="#Style" class="headerlink" title="Style"></a>Style</h4><p><img src="https://raw.githubusercontent.com/lennyup/img-warehouse/master/style.png" alt=""></p><p>解答：<br>官方文档定义如下：</p><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">A style is <span class="keyword">a</span> collection <span class="keyword">of</span> properties that specify <span class="keyword">the</span> look <span class="keyword">and</span> <span class="built_in">format</span> <span class="keyword">for</span> <span class="keyword">a</span> View <span class="keyword">or</span> window</div><div class="line"></div><div class="line">A theme is <span class="keyword">a</span> style applied <span class="built_in">to</span> <span class="keyword">an</span> entire Activity <span class="keyword">or</span> application</div></pre></td></tr></table></figure><p>补充一句：style和theme本质上就是同一东西，xml格式万千相同，只是我用在activity上我就叫它theme，我用在view上我就叫它style。唯一的区别就是style里头控制的各个属性了，某些属性是只有针对activity才能生效的。所以style可以作用在activity上，但是theme却不能反过来作用在view上</p><p>theme是被final标识了，不能被继承 ABD</p><p>未完待续。。。。。。。。。。。</p>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;前言&quot;&gt;&lt;a href=&quot;#前言&quot; class=&quot;headerlink&quot; title=&quot;前言&quot;&gt;&lt;/a&gt;前言&lt;/h3&gt;&lt;p&gt;这段时间，掘金出了个掘金秋招求职征文大赛，好想参加，但是自己貌似已经一年多没有参加过面试了（似的，我变懒了，这是不对的 ps： 捂脸哭），看见好多大佬的文章，感觉自己没有学过Android了，是时候把自己以前遗落的再次捡起来了，这里只是提供一些面试题和一些基础的知识，可能会不全，甚至会有错误（清喷），我会不定时更新的。&lt;br&gt;
    
    </summary>
    
    
      <category term="Android" scheme="https://lennyup.github.io/tags/Android/"/>
    
  </entry>
  
  <entry>
    <title>React Native 集成原生组件（Android）</title>
    <link href="https://lennyup.github.io/2017/09/15/rn-native/"/>
    <id>https://lennyup.github.io/2017/09/15/rn-native/</id>
    <published>2017-09-15T03:42:04.000Z</published>
    <updated>2017-10-11T06:15:06.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="一、前言"><a href="#一、前言" class="headerlink" title="一、前言"></a>一、前言</h3><p> 最近一直在做公司项目的 4.0 版本重构，在重构中有一个需求，要求对<code>FlatList</code>的下拉刷新做统一的修改，就是要达到<code>Android</code>和<code>IOS</code>的效果一致(emmmm), <code>React Native</code>官方给的样式是两端不一样的效果，在<code>Android</code>端，是用的<code>Swiperefresh</code>。在网上搜到的一些都是很久没有更新的git项目或者就是达不到我们高大上的 UI的要求，于是乎，我走上了封装原生组件的道路。下面我说下我进行封装的几个步骤。<br><a id="more"></a></p><h3 id="二、主要步骤"><a href="#二、主要步骤" class="headerlink" title="二、主要步骤"></a>二、主要步骤</h3><h4 id="1、原生组件"><a href="#1、原生组件" class="headerlink" title="1、原生组件"></a>1、原生组件</h4><p>第一步，我们需要一个自己的原生组件，然后对组件进行包装。</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">public <span class="class"><span class="keyword">class</span> <span class="title">PullRefreshLayout</span> <span class="keyword">extends</span> <span class="title">ViewGroup</span> </span>&#123;</div><div class="line">....</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>这是我自己写的下拉刷新的原生组件，至于自定义<code>ViewGroup</code>这里就不过多概述了。</p><h4 id="2、创建ViewManager子类"><a href="#2、创建ViewManager子类" class="headerlink" title="2、创建ViewManager子类"></a>2、创建ViewManager子类</h4><p>因为我这里的组件是<code>ViewGroup</code>,所有我的<code>ViewManager</code>要继承<code>ViewGroupManager</code>,如果是<code>View</code>的话，就是<code>SimpleViewManager</code>。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PullRefreshLayoutManager</span> <span class="keyword">extends</span> <span class="title">ViewGroupManager</span>&lt;<span class="title">PullRefreshLayout</span>&gt; </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">protected</span> <span class="keyword">static</span> <span class="keyword">final</span> String REACT_CLASS = <span class="string">"RCTPullRefreshLayout"</span>;</div><div class="line"></div><div class="line">    <span class="keyword">protected</span> <span class="keyword">static</span> <span class="keyword">final</span> String TYPE_REFRESH = <span class="string">"refreshFunc"</span>;</div><div class="line"></div><div class="line">    <span class="keyword">protected</span> <span class="keyword">static</span> <span class="keyword">final</span> String TYPE_DRAG = <span class="string">"onDrag"</span>;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String PROP_REFRESHING = <span class="string">"isRefreshing"</span>;</div><div class="line">    <span class="keyword">private</span> ThemedReactContext aContext;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> REACT_CLASS;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> PullRefreshLayout <span class="title">createViewInstance</span><span class="params">(ThemedReactContext reactContext)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.aContext = reactContext;</div><div class="line">        <span class="keyword">final</span> PullRefreshLayout layout = <span class="keyword">new</span> PullRefreshLayout(reactContext);</div><div class="line">        layout.setRefreshDrawable(<span class="keyword">new</span> XeDrawable(reactContext, layout));</div><div class="line">        <span class="keyword">final</span> EventDispatcher mEventDispatcher = reactContext.</div><div class="line">                getNativeModule(UIManagerModule.class).getEventDispatcher();</div><div class="line">        layout.setOnRefreshListener(<span class="keyword">new</span> PullRefreshLayout.OnRefreshListener() &#123;</div><div class="line">            <span class="meta">@Override</span></div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onRefresh</span><span class="params">()</span> </span>&#123;</div><div class="line">                mEventDispatcher.dispatchEvent(<span class="keyword">new</span> LayoutRefreshEvent(layout.getId(), TYPE_REFRESH));</div><div class="line">            &#125;</div><div class="line"></div><div class="line">            <span class="meta">@Override</span></div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onDrag</span><span class="params">(<span class="keyword">float</span> percent)</span> </span>&#123;</div><div class="line">                mEventDispatcher.dispatchEvent(<span class="keyword">new</span> LayoutRefreshEvent(layout.getId(), TYPE_DRAG, percent));</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line">        <span class="keyword">return</span> layout;</div><div class="line">    &#125;</div><div class="line">  &#125;</div></pre></td></tr></table></figure><p>这里必须重写的两个方法 <code>getName</code>和<code>createViewInstance</code>，<br><code>getName</code>方法返回的名字用于该在JavaScript中进行调用</p><p>视图会通过<code>createViewInstance</code>方法进行创建，同时会被初始化为默认状态。然后属性的话 会通过<code>updateView</code>方法进行更新,所以我们一般对齐做一些初始化的东西，我这里是设置下拉刷新的样式以及刷新的回调，<br>细心的大佬们可能会发现，这里有一个 <code>EventDispatcher</code>,这个在以后会讲到。</p><h4 id="3、使用-ReactProp-或者-ReactPropGroup-注解相关方法对外可以被调用设置属性"><a href="#3、使用-ReactProp-或者-ReactPropGroup-注解相关方法对外可以被调用设置属性" class="headerlink" title="3、使用@ReactProp(或者@ReactPropGroup)注解相关方法对外可以被调用设置属性"></a>3、使用@ReactProp(或者@ReactPropGroup)注解相关方法对外可以被调用设置属性</h4><p>有时候我们会看到有一些RN的组件的一些属性，比如说<code>Image</code>的<code>src</code>,如果需要提供属性方便在JavaScript中调用的话，那么需要设置方法使用@ReactProp(或者@ReactPropGroup)进行注解，例如：</p><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@ReactProp</span>(name = PROP_REFRESHING)</div><div class="line"> <span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">setRefresing</span> <span class="params">(PullRefreshLayout layout, <span class="keyword">boolean</span> isRefreshing)</span> </span>&#123;</div><div class="line">     layout.setRefreshing(isRefreshing);</div><div class="line"> &#125;</div></pre></td></tr></table></figure><p>设置方法的第一个参数就是实例本身，第二个参数就是需要设置的属性值。该方法的返回值必须是void，访问权限必须是public。其中在JavaScript的获取的属性的类型由第二个参数的类型决定。其支持的类型为：<code>boolean</code>、<code>int</code>、<code>float</code>、<code>String</code>、<code>Boolean</code>、<code>Integer</code>、<code>ReadableArray</code>、<code>ReadableMap</code></p><p>使用@ReactProp注解的 name是指向JavaScript中的调用的属性名。<br>除了name之外，@ReactProp注解还接受一些其他属性，例如：<code>defaultBoolean、</code>defaultInt<code>、</code>defaultFloat`。其对应的类型必须是（boolean，int，float）null为默认值。</p><p>@ReactPropGroup注解的使用方法，目前我还没搞明白，等以后搞明白，我会及时补充的。</p><h3 id="4、事件"><a href="#4、事件" class="headerlink" title="4、事件"></a>4、事件</h3><p>这里，我举个例子，在<code>Image</code>使用中，有一个<code>onLoad</code>，我们可以在其回调的时候写自己的逻辑，那么我们在自己封装的时候如果也有着样的需求的话该如何做呢？</p><p>这里就要说我们之后留了一个悬念的<code>EventDispatcher</code>,我们先看下代码，可能会更加直观一点。</p><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">final</span> EventDispatcher mEventDispatcher = reactContext.</div><div class="line">         getNativeModule(UIManagerModule.class).getEventDispatcher();</div><div class="line"> layout.setOnRefreshListener(<span class="keyword">new</span> PullRefreshLayout.OnRefreshListener() &#123;</div><div class="line">     <span class="meta">@Override</span></div><div class="line">     <span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">onRefresh</span><span class="params">()</span> </span>&#123;</div><div class="line">         mEventDispatcher.dispatchEvent(<span class="keyword">new</span> LayoutRefreshEvent(layout.getId(), TYPE_REFRESH));</div><div class="line">     &#125;</div><div class="line"></div><div class="line">     <span class="meta">@Override</span></div><div class="line">     <span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">onDrag</span><span class="params">(<span class="keyword">float</span> percent)</span> </span>&#123;</div><div class="line">         mEventDispatcher.dispatchEvent(<span class="keyword">new</span> LayoutRefreshEvent(layout.getId(), TYPE_DRAG, percent));</div><div class="line">     &#125;</div><div class="line"> &#125;);</div></pre></td></tr></table></figure><p>这个事件名<code>onRefresh</code>在JavaScript端映射到<code>onRefresh</code>回调属性上（这两个是通过 getId关联在一起的）</p><h4 id="5、创建-Event"><a href="#5、创建-Event" class="headerlink" title="5、创建 Event"></a>5、创建 Event</h4><p>当然 这个不是必须的，但是我还是建议创建。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LayoutRefreshEvent</span> <span class="keyword">extends</span> <span class="title">Event</span>&lt;<span class="title">LayoutRefreshEvent</span>&gt;</span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String mEventType;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">float</span> mPercent;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">LayoutRefreshEvent</span><span class="params">(<span class="keyword">int</span> viewId, String mEventType)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>(viewId);</div><div class="line">        <span class="keyword">this</span>.mEventType = mEventType;</div><div class="line">        <span class="keyword">this</span>.mPercent = <span class="number">1f</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">LayoutRefreshEvent</span><span class="params">(<span class="keyword">int</span> viewTag, String mEventType, <span class="keyword">float</span> mPercent)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>(viewTag);</div><div class="line">        <span class="keyword">this</span>.mEventType = mEventType;</div><div class="line">        <span class="keyword">this</span>.mPercent = mPercent;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getEventName</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> mEventType;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">dispatch</span><span class="params">(RCTEventEmitter rctEventEmitter)</span> </span>&#123;</div><div class="line">        WritableMap eventData = Arguments.createMap();</div><div class="line">        eventData.putDouble(<span class="string">"percent"</span>, mPercent);</div><div class="line">        rctEventEmitter.receiveEvent(getViewTag(), getEventName(), eventData);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>连个构造方法我就不多说了， 这里说下 <code>getEventName</code>和<code>dispath</code><br><code>getEventName</code>返回我们映射到JavaScript上的哪个毁掉属性上，<br>看下这句：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="selector-tag">rctEventEmitter</span><span class="selector-class">.receiveEvent</span>(<span class="selector-tag">getViewTag</span>(), <span class="selector-tag">getEventName</span>(), <span class="selector-tag">eventData</span>);</div></pre></td></tr></table></figure><p>这里最主要的部分，这句的意思是 携带参数映射到JavaScript上，稍后我们看下 JavaScript上如何做。</p><figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="selector-tag">mEventDispatcher</span><span class="selector-class">.dispatchEvent</span>(<span class="selector-tag">new</span> <span class="selector-tag">LayoutRefreshEvent</span>(<span class="selector-tag">layout</span><span class="selector-class">.getId</span>(), <span class="selector-tag">TYPE_REFRESH</span>));</div></pre></td></tr></table></figure><h4 id="6、创建Package，注册Manager"><a href="#6、创建Package，注册Manager" class="headerlink" title="6、创建Package，注册Manager"></a>6、创建Package，注册Manager</h4><p>这里就应该比较熟悉了，封装原生的东西 都会创建的。</p><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PullRefreshLayoutPackage</span>  <span class="keyword">implements</span> <span class="title">ReactPackage</span></span>&#123;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="keyword">public</span> List&lt;NativeModule&gt; createNativeModules(ReactApplicationContext reactContext) &#123;</div><div class="line">        <span class="function"><span class="keyword">return</span> Collections.<span class="title">emptyList</span><span class="params">()</span></span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="keyword">public</span> List&lt;Class&lt;? <span class="keyword">extends</span> JavaScriptModule&gt;&gt; createJSModules() &#123;</div><div class="line">        <span class="function"><span class="keyword">return</span> Collections.<span class="title">emptyList</span><span class="params">()</span></span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="keyword">public</span> List&lt;ViewManager&gt; createViewManagers(ReactApplicationContext reactContext) &#123;</div><div class="line">        <span class="keyword">return</span> Arrays.&lt;ViewManager&gt;asList(<span class="keyword">new</span> PullRefreshLayoutManager());</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><p> 这次，我们创建的不是 Module，我们的注册要放在 Managers里，如上。</p><h4 id="7、Application添加-Package"><a href="#7、Application添加-Package" class="headerlink" title="7、Application添加 Package"></a>7、Application添加 Package</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">protected</span> List&lt;ReactPackage&gt; <span class="title">getPackages</span><span class="params">()</span> </span>&#123;</div><div class="line">  <span class="keyword">return</span> Arrays.&lt;ReactPackage&gt;asList(</div><div class="line">          <span class="keyword">new</span> MainReactPackage(),</div><div class="line">...</div><div class="line"><span class="keyword">new</span> PullRefreshLayoutPackage()</div><div class="line">  );</div><div class="line">&#125;</div></pre></td></tr></table></figure><h4 id="8、实现JavaScript模块"><a href="#8、实现JavaScript模块" class="headerlink" title="8、实现JavaScript模块"></a>8、实现JavaScript模块</h4><p>下面最后一步就是创建JavaScript层，定义Java和JavaScript的接口层。大部分的功能都是通过React 底层的Java和Javas进行完成下面就是说需要使用propType属性进行设置属性的类型。</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">import React from <span class="string">'react'</span></div><div class="line">import &#123;</div><div class="line">  View,</div><div class="line">  requireNativeComponent</div><div class="line">&#125; from <span class="string">'react-native'</span></div><div class="line"></div><div class="line">let PullRefreshLayout = &#123;</div><div class="line">  displayName: <span class="string">'PullRefreshLayout'</span>,</div><div class="line">  propTypes: &#123;</div><div class="line">    isRefreshing: React<span class="selector-class">.PropTypes</span><span class="selector-class">.bool</span>,</div><div class="line">    refreshFunc: React<span class="selector-class">.PropTypes</span><span class="selector-class">.func</span>,</div><div class="line">    onDrag: React<span class="selector-class">.PropTypes</span><span class="selector-class">.func</span>,</div><div class="line">    ..<span class="selector-class">.View</span><span class="selector-class">.propTypes</span>  <span class="comment">// 支持View组件的所有属性</span></div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">const RCTPullRefreshLayout = requireNativeComponent(<span class="string">'RCTPullRefreshLayout'</span>, PullRefreshLayout)</div><div class="line"></div><div class="line">export default RCTPullRefreshLayout</div></pre></td></tr></table></figure><p>requireNativeComponent会接受两个参数，第一个参数就是之前我们getName方法返回的名称（代表视图的名字），第二个参数表示描述设置的对象。当前对象的name的值必须设置恰当，因为该值会在调试中进行打印。该对象海需要进行声明propType字段，用来反映原生视图。同时propTyes对象可以用来检查用户使用的原生视图的正确与否。</p><p>如果你需要进行一些自定义的事件，那么你可以通过一个普通的React组件进行封装原生组件，那么requireNativeComponent的第二个参数可以传入封装的组件而不是我们上面的<code>PullRefreshLayout</code>,这里我们看下官网给的例子：</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyCustomView</span> <span class="keyword">extends</span> <span class="title">View</span> </span>&#123;</div><div class="line">   ...</div><div class="line">   public void onReceiveNativeEvent() &#123;</div><div class="line">      <span class="type">WritableMap</span> event = <span class="type">Arguments</span>.createMap();</div><div class="line">      event.putString(<span class="string">"message"</span>, <span class="string">"MyMessage"</span>);</div><div class="line">      <span class="type">ReactContext</span> reactContext = (<span class="type">ReactContext</span>)getContext();</div><div class="line">      reactContext.getJSModule(<span class="type">RCTEventEmitter</span>.<span class="keyword">class</span>).receiveEvent(</div><div class="line">          getId(),</div><div class="line">          <span class="string">"topChange"</span>,</div><div class="line">          event);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyCustomView</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</div><div class="line">  constructor() &#123;</div><div class="line">    <span class="keyword">this</span>._onChange = <span class="keyword">this</span>._onChange.bind(<span class="keyword">this</span>);</div><div class="line">  &#125;</div><div class="line">  _onChange(event: <span class="type">Event</span>) &#123;</div><div class="line">    <span class="keyword">if</span> (!<span class="keyword">this</span>.props.onChangeMessage) &#123;</div><div class="line">      <span class="keyword">return</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">this</span>.props.onChangeMessage(event.nativeEvent.message);</div><div class="line">  &#125;</div><div class="line">  render() &#123;</div><div class="line">    <span class="keyword">return</span> &lt;<span class="type">RCTMyCustomView</span> &#123;...<span class="keyword">this</span>.props&#125; onChange=&#123;<span class="keyword">this</span>._onChange&#125; /&gt;;</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"><span class="type">MyCustomView</span>.propTypes = &#123;</div><div class="line">  <span class="comment">/**</span></div><div class="line">   * Callback that is called continuously when the user is dragging the map.</div><div class="line">   */</div><div class="line">  onChangeMessage: <span class="type">React</span>.<span class="type">PropTypes</span>.func,</div><div class="line">  ...</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="keyword">var</span> <span class="type">RCTMyCustomView</span> = requireNativeComponent(`<span class="type">RCTMyCustomView</span>`, <span class="type">MyCustomView</span>, &#123;</div><div class="line">  nativeOnly: &#123;onChange: <span class="literal">true</span>&#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure><p>可以看到，上面用到<code>nativeOnly</code> 。有时候有一些特殊的属性，想从原生组件中导出，但是又不希望它们成为对应React封装组件的属性。举个例子，<code>Switch</code>组件可能在原生组件上有一个<code>onChange</code>事件，然后在封装类中导出<code>onValueChange</code>回调属性。这个属性在调用的时候会带上Switch的状态作为参数之一。这样的话你可能不希望原生专用的属性出现在API之中，也就不希望把它放到propType里。可是如果你不放的话，优惠出现一个报错。解决方案就是带上<code>nativeOnly</code>选项。（ps： 这是官网的原话，我觉得比我自己说的话要好，就直接拿过来了）</p><h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>这里只是介绍了 android端封装原生组件的步骤，记得但开始做这个的时候，脑子一片空白，然后各种查资料。果然是书到用时方恨少！！！！！</p><h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><p><a href="https://reactnative.cn/docs/0.48/native-component-android.html#content" target="_blank" rel="external">原生UI组件-官网</a></p><p><a href="https://juejin.im/entry/5724249671cfe400576a21f9" target="_blank" rel="external">React Native 进阶之原生 UI 组件封装详解</a></p><p><a href="http://www.jianshu.com/p/f26d994ea765" target="_blank" rel="external">React-Native之Android:封装原生UI组件</a></p>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;一、前言&quot;&gt;&lt;a href=&quot;#一、前言&quot; class=&quot;headerlink&quot; title=&quot;一、前言&quot;&gt;&lt;/a&gt;一、前言&lt;/h3&gt;&lt;p&gt; 最近一直在做公司项目的 4.0 版本重构，在重构中有一个需求，要求对&lt;code&gt;FlatList&lt;/code&gt;的下拉刷新做统一的修改，就是要达到&lt;code&gt;Android&lt;/code&gt;和&lt;code&gt;IOS&lt;/code&gt;的效果一致(emmmm), &lt;code&gt;React Native&lt;/code&gt;官方给的样式是两端不一样的效果，在&lt;code&gt;Android&lt;/code&gt;端，是用的&lt;code&gt;Swiperefresh&lt;/code&gt;。在网上搜到的一些都是很久没有更新的git项目或者就是达不到我们高大上的 UI的要求，于是乎，我走上了封装原生组件的道路。下面我说下我进行封装的几个步骤。&lt;br&gt;
    
    </summary>
    
    
      <category term="React Native" scheme="https://lennyup.github.io/tags/React-Native/"/>
    
  </entry>
  
  <entry>
    <title>Android 7.0 行为变更之FileProvider</title>
    <link href="https://lennyup.github.io/2017/06/09/file-provider/"/>
    <id>https://lennyup.github.io/2017/06/09/file-provider/</id>
    <published>2017-06-09T05:48:45.000Z</published>
    <updated>2017-10-11T06:14:55.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="一、简述"><a href="#一、简述" class="headerlink" title="一、简述"></a>一、简述</h3><p>之前在做拍照功能的时候，在7.0系统的手机上会出现问题，在看了看官网的<a href="https://developer.android.com/about/versions/nougat/android-7.0-changes.html" target="_blank" rel="external">Android 7.0行为变更</a>,才知道问题出在了哪里，适配的话必须去除项目中传递<code>file://</code>类似格式的uri了。<br><a id="more"></a><br><figure class="highlight delphi"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">在<span class="number">7.0</span> 以及以上的系统中，如果传递<span class="keyword">file</span>:<span class="comment">// 会触发FileUriExposedException异常</span></div></pre></td></tr></table></figure></p><p>在这里我仅把我遇到的问题以及解决办法说下，便于记录，没有什么技术含量的</p><p><img src="http://img.mp.itc.cn/upload/20170325/525cb4f28a4c426fb336116f810228e3.jpeg" alt=""></p><h3 id="二、拍照中的问题"><a href="#二、拍照中的问题" class="headerlink" title="二、拍照中的问题"></a>二、拍照中的问题</h3><p>拍照的代码我想大家都会熟悉，我们制定拍照的图片路径，intent传递一个uri给相机应用。</p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> REQUEST_LAUNCH_IMAGE_LIBRARY = <span class="number">13002</span>;</div><div class="line"></div><div class="line"><span class="keyword">private</span> Uri mCameraCaptureURI;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="keyword">void</span> launchCamera() &#123;</div><div class="line"><span class="comment">// 判断相机是否可用以及sd卡是否可用、相机权限是否开启</span></div><div class="line">...</div><div class="line"><span class="keyword">int</span> requestCode = REQUEST_LAUNCH_IMAGE_LIBRARY;</div><div class="line">Intent cameraIntent = <span class="keyword">new</span> Intent(MediaStore.ACTION_IMAGE_CAPTURE);</div><div class="line">String filename = <span class="keyword">new</span> StringBuilder(<span class="string">"image-"</span>).<span class="keyword">append</span>(UUID.randomUUID().toString()).<span class="keyword">append</span>(<span class="string">".jpg"</span>).toString();</div><div class="line"><span class="keyword">File</span> path = mContext.getExernalFilesDir(Environment.DIRECTORY_PICTURES)</div><div class="line"><span class="keyword">File</span> imageFile = <span class="keyword">new</span> <span class="keyword">File</span>(path, filename);</div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            path.mkdirs();</div><div class="line">            imageFile.createNewFile();</div><div class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</div><div class="line">            e.printStackTrace();</div><div class="line">        &#125;</div><div class="line">mCameraCaptureURI = Uri.fromFile(imageFile);</div><div class="line">cameraIntent.putExtra(MediaStore.EXTRA_OUTPUT, mCameraCaptureURI);</div><div class="line">        <span class="keyword">if</span> (cameraIntent.resolveActivity(mActivity.getPackageManager()) == <span class="keyword">null</span>) &#123;</div><div class="line">            showToast(<span class="string">"无法调起相机"</span>);</div><div class="line">            <span class="keyword">return</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            mActivity.startActivityForResult(cameraIntent, requestCode);</div><div class="line">        &#125; <span class="keyword">catch</span> (ActivityNotFoundException e) &#123;</div><div class="line">            e.printStackTrace();</div><div class="line">        &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">@Override</div><div class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> onActivityResult(<span class="keyword">int</span> requestCode, <span class="keyword">int</span> resultCode, Intent data) &#123;</div><div class="line">        <span class="keyword">super</span>.onActivityResult(requestCode, resultCode, data);</div><div class="line">        <span class="keyword">if</span> (resultCode == RESULT_OK &amp;&amp; requestCode == REQUEST_LAUNCH_IMAGE_LIBRARY) &#123;</div><div class="line">...</div><div class="line">        &#125;</div><div class="line">    &#125;</div></pre></td></tr></table></figure><p><img src="http://d.hiphotos.baidu.com/zhidao/wh%3D450%2C600/sign=85d5e4568f94a4c20a76ef2f3bc437e3/e4dde71190ef76c6f4b2fe729516fdfaaf516702.jpg" alt="我不是效果图"></p><p>哈哈，我知道,没图你们是不会往下看的（ps： 效果图我不给你贴！ 滑稽）</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">Caused by: android<span class="selector-class">.os</span><span class="selector-class">.FileUriExposedException</span>:</div><div class="line">    file:<span class="comment">///storage/emulated/0/image-1085d49f-76f0-495f-8bdb-38b972299e00.jpg</span></div><div class="line">        exposed beyond app through ClipData<span class="selector-class">.Item</span><span class="selector-class">.getUri</span>()</div><div class="line">    at android<span class="selector-class">.os</span><span class="selector-class">.StrictMode</span><span class="selector-class">.onFileUriExposed</span>(StrictMode<span class="selector-class">.java</span>:<span class="number">1932</span>)</div><div class="line">    at android<span class="selector-class">.net</span><span class="selector-class">.Uri</span><span class="selector-class">.checkFileUriExposed</span>(Uri<span class="selector-class">.java</span>:<span class="number">2348</span>)</div></pre></td></tr></table></figure><p>我的天，在7.0系统的手机上报错了，我去找原因！～</p><p>我们看下官网给出的解释：</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">对于面向 Android <span class="number">7.0</span> 的应用，Android 框架执行的 StrictMode API 政策禁止在您的应用外部公开 <span class="string">file:</span><span class="comment">// URI。如果一项包含文件 URI 的 intent 离开您的应用，则应用出现故障，并出现 FileUriExposedException 异常。</span></div><div class="line"></div><div class="line">要在应用间共享文件，您应发送一项 <span class="string">content:</span><span class="comment">// URI，并授予 URI 临时访问权限。进行此授权的最简单方式是使用 FileProvider 类。如需了解有关权限和共享文件的详细信息，请参阅共享文件</span></div></pre></td></tr></table></figure><p><img src="http://img.tvmao.com/thumb/tvcolumn/0/409/360x270.jpg" alt=""></p><p>官网也给出了解决的办法，那就是用 <code>FileProvider</code>. 我们看下他的实现步骤</p><h3 id="使用FileProvider"><a href="#使用FileProvider" class="headerlink" title="使用FileProvider"></a>使用FileProvider</h3><p>在这里，对于<code>FileProvider</code>的使用，官网上给出了详细的步骤，有时间的话可以看下。<br><a href="https://developer.android.com/reference/android/support/v4/content/FileProvider.html" target="_blank" rel="external">FileProvider</a></p><h4 id="1-声明provider"><a href="#1-声明provider" class="headerlink" title="1.声明provider"></a>1.声明provider</h4><figure class="highlight dust"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="xml"><span class="tag">&lt;<span class="name">provider</span></span></span></div><div class="line">            <span class="attr">android:name</span>=<span class="string">"android.support.v4.content.FileProvider"</span></div><div class="line">            <span class="attr">android:authorities</span>=<span class="string">"$</span><span class="template-variable">&#123;applicationId&#125;</span><span class="xml"><span class="tag"><span class="string">.provider"</span></span></span></div><div class="line">            <span class="attr">android:exported</span>=<span class="string">"false"</span></div><div class="line">            <span class="attr">android:grantUriPermissions</span>=<span class="string">"true"</span>&gt;</div><div class="line">            <span class="tag">&lt;<span class="name">meta-data</span></span></div><div class="line">                <span class="attr">android:name</span>=<span class="string">"android.support.FILE_PROVIDER_PATHS"</span></div><div class="line">                <span class="attr">android:resource</span>=<span class="string">"@xml/provider_path"</span> /&gt;</div><div class="line">        <span class="tag">&lt;/<span class="name">provider</span>&gt;</span></div></pre></td></tr></table></figure><p>FileProvider 是<code>ContentProvider</code>的子类， 所以需要声明一下下<br>meta-data里的 resource是自己写的xml文件。关于其中其他的配置在后面会讲道，莫急。</p><h4 id="2-编写xml"><a href="#2-编写xml" class="headerlink" title="2.编写xml"></a>2.编写xml</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="php"><span class="meta">&lt;?</span>xml version=<span class="string">"1.0"</span> encoding=<span class="string">"utf-8"</span><span class="meta">?&gt;</span></span></div><div class="line"><span class="tag">&lt;<span class="name">paths</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">external-path</span> <span class="attr">name</span>=<span class="string">"app_images"</span> <span class="attr">path</span>=<span class="string">"."</span>/&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">paths</span>&gt;</span></div></pre></td></tr></table></figure><p>在<code>path</code>节点 支持以下几个字节点：</p><ul><li><code>&lt;root-path/&gt;</code> 代表设备的根目录<code>new File(&quot;/&quot;)</code>;</li><li><code>&lt;files-path/&gt;</code> 代表<code>context.getFilesDir()</code>;</li><li><code>&lt;cache-path/&gt;</code> 代表<code>context.getCacheDir()</code>;</li><li><code>&lt;external-path/&gt;</code> 代表<code>Environment.getExternalStorageDirectory()</code>;</li><li><code>&lt;external-files-path/&gt;</code>代表<code>context.getExternalFilesDirs()</code>;</li><li><code>&lt;external-cache-path/&gt;</code>代表<code>getExternalCacheDirs()</code>;</li></ul><p>每个节点支持两个属性：</p><ul><li><code>path</code> 需要临时授权访问的路径 . 代表所有路径</li><li><code>name</code> 就是你给这个路径起的名字</li></ul><p>我们所要做的是用 <code>content://uri</code>来替代<code>file://uri</code>,所以我们需要一个虚拟的路径进行映射，这就是我们要编写这个xml文件的原因。通过path确定访问目录，通过name映射真实的路径。</p><h4 id="使用-FileProvider"><a href="#使用-FileProvider" class="headerlink" title="使用 FileProvider"></a>使用 FileProvider</h4><p>这里我只贴一下核心的代码，其他的和之前写的是一样的</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 之前</span></div><div class="line">mCameraCaptureURI = <span class="built_in">Uri</span>.fromFile(imageFile);</div><div class="line"><span class="comment">// 使用FileProvider</span></div><div class="line"><span class="keyword">final</span> <span class="built_in">String</span> packageName = context.getApplicationContext().getPackageName();</div><div class="line">            <span class="keyword">final</span> <span class="built_in">String</span> authority =  <span class="keyword">new</span> StringBuilder(packageName).append(<span class="string">".provider"</span>).toString();</div><div class="line">            <span class="keyword">try</span></div><div class="line">            &#123;</div><div class="line">                mCameraCaptureURI = FileProvider.getUriForFile(context, authority, file);</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">catch</span>(IllegalArgumentException e)</div><div class="line">            &#123;</div><div class="line">                e.printStackTrace();</div><div class="line">            &#125;</div></pre></td></tr></table></figure><p>第二个参数就是我们之前在<code>AndroidManifest.xml</code>里配置的那个<code>authority</code></p><p>在此，可能会有疑问 为什么配置的时候</p><figure class="highlight avrasm"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="symbol">android:</span>exported=<span class="string">"false"</span></div><div class="line"><span class="symbol">android:</span>grantUriPermissions=<span class="string">"true"</span></div></pre></td></tr></table></figure><p>要这么写，<br>这里就要看下源码了</p><figure class="highlight smali"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">@Override<span class="keyword"></span></div><div class="line">public void attachInfo(Context context, ProviderInfo info) &#123;</div><div class="line">    super.attachInfo(context, info);</div><div class="line"></div><div class="line">    // Sanity<span class="built_in"> check </span>our security</div><div class="line">   <span class="built_in"> if </span>(info.exported) &#123;</div><div class="line">       <span class="built_in"> throw </span>new SecurityException(<span class="string">"Provider must not be exported"</span>);</div><div class="line">    &#125;</div><div class="line">   <span class="built_in"> if </span>(!info.grantUriPermissions) &#123;</div><div class="line">       <span class="built_in"> throw </span>new SecurityException(<span class="string">"Provider must grant uri permissions"</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    mStrategy = getPathStrategy(context, info.authority);</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>知道了吧，使用FileProvider之后我们在7.0的系统上拍照是没有问题了，那么是否可以做到兼容呢，我们在5.0 的手机上运行下，</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">Caused by: java<span class="selector-class">.lang</span><span class="selector-class">.SecurityException</span>: Permission Denial: opening provider android<span class="selector-class">.support</span><span class="selector-class">.v4</span><span class="selector-class">.content</span><span class="selector-class">.FileProvider</span> from ProcessRecord&#123;<span class="number">52</span>b029b8 <span class="number">1670</span>:com<span class="selector-class">.android</span><span class="selector-class">.camera</span>/u0a36&#125; (pid=<span class="number">1670</span>, uid=<span class="number">10036</span>) that is not exported from uid <span class="number">10052</span></div><div class="line">at android<span class="selector-class">.os</span><span class="selector-class">.Parcel</span><span class="selector-class">.readException</span>(Parcel<span class="selector-class">.java</span>:<span class="number">1465</span>)</div><div class="line">at android<span class="selector-class">.os</span><span class="selector-class">.Parcel</span><span class="selector-class">.readException</span>(Parcel<span class="selector-class">.java</span>:<span class="number">1419</span>)</div><div class="line">at android<span class="selector-class">.app</span><span class="selector-class">.ActivityManagerProxy</span><span class="selector-class">.getContentProvider</span>(ActivityManagerNative<span class="selector-class">.java</span>:<span class="number">2848</span>)</div><div class="line">at android<span class="selector-class">.app</span><span class="selector-class">.ActivityThread</span><span class="selector-class">.acquireProvider</span>(ActivityThread<span class="selector-class">.java</span>:<span class="number">4399</span>)</div></pre></td></tr></table></figure><p>我的天， 又报错了，这次是<code>Permission Denial</code></p><p><img src="http://img4.imgtn.bdimg.com/it/u=4080811263,601276283&amp;fm=11&amp;gp=0.jpg" alt=""></p><p>通过万能的google了解到 需要给uri开通 读写的权限</p><h5 id="思路一"><a href="#思路一" class="headerlink" title="思路一"></a>思路一</h5><p>利用 <code>context. grantUriPermission</code> 对所有包都开启权限（ps：有时候并不晓得会选择哪个app）</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">List</span>&lt;ResolveInfo&gt; resInfoList = getPackageManager()</div><div class="line">               .queryIntentActivities(takePictureIntent, PackageManager.MATCH_DEFAULT_ONLY);</div><div class="line">       <span class="keyword">for</span> (ResolveInfo resolveInfo : resInfoList) &#123;</div><div class="line">           <span class="built_in">String</span> packageName = resolveInfo.activityInfo.packageName;</div><div class="line">           grantUriPermission(packageName, fileUri, Intent.FLAG_GRANT_READ_URI_PERMISSION</div><div class="line">                   | Intent.FLAG_GRANT_WRITE_URI_PERMISSION);</div><div class="line">       &#125;</div></pre></td></tr></table></figure><h5 id="思路二"><a href="#思路二" class="headerlink" title="思路二"></a>思路二</h5><p>上一个虽然可以解决，但是觉得有些麻烦，我可以根据系统的版本进行判断的呀</p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span> (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.N) &#123;</div><div class="line">    fileUri = FileProvider.getUriForFile(<span class="keyword">this</span>, <span class="string">"com.lenny.a7.provider"</span>, <span class="keyword">file</span>);</div><div class="line">&#125; <span class="keyword">else</span> &#123;</div><div class="line">    fileUri = Uri.fromFile(<span class="keyword">file</span>);</div><div class="line">&#125;</div></pre></td></tr></table></figure><h3 id="安装apk"><a href="#安装apk" class="headerlink" title="安装apk"></a>安装apk</h3><p>我们知道以前我们安装apk，是这么写的</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">private void InstallAPK(String filePath)&#123;</div><div class="line">     Intent i = new Intent(Intent.ACTION_VIEW);</div><div class="line">     i.addFlags(Intent.FLAG_ACTIVITY_NEW_TASK);</div><div class="line">     i.setDataAndType(Uri.parse(<span class="string">"file://"</span> + filePath),<span class="string">"application/vnd.android.package-archive"</span>);</div><div class="line">     mContext.startActivity(i);</div><div class="line">     System.<span class="keyword">exit</span>(<span class="number">0</span>);</div><div class="line"> &#125;</div></pre></td></tr></table></figure><p>在7.0系统以上的手机上又出现 <code>android.os.FileUriExposedException</code>异常。在上一个例子中，我们知道了如何处理：根据系统进行处理。可是这次出现了<br><code>Permission Denial</code></p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">ava<span class="selector-class">.lang</span><span class="selector-class">.SecurityException</span>: Permission Denial:</div><div class="line">opening provider android<span class="selector-class">.support</span><span class="selector-class">.v4</span><span class="selector-class">.content</span><span class="selector-class">.FileProvider</span></div><div class="line">        from ProcessRecord&#123;<span class="number">18570</span>a <span class="number">27107</span>:com<span class="selector-class">.google</span><span class="selector-class">.android</span><span class="selector-class">.packageinstaller</span>/u0a26&#125; (pid=<span class="number">27107</span>, uid=<span class="number">10026</span>) that is not exported from UID <span class="number">10004</span></div></pre></td></tr></table></figure><p>我们可以在其加上上一个例子里的思路一的代码，加上权限。</p><p>通过与大神交流之后，知道原来还有一种方式可以搞定，那就是：</p><figure class="highlight fortran"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">intent</span>.addFlags(<span class="keyword">Intent</span>.FLAG_GRANT_READ_URI_PERMISSION | <span class="keyword">Intent</span>.FLAG_GRANT_WRITE_URI_PERMISSION);</div></pre></td></tr></table></figure><p>那么我们的解决办法也就可以这样：</p><figure class="highlight fortran"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> static Uri getUriFormFile(Context context, String filePath, <span class="keyword">Intent</span> <span class="keyword">intent</span>) &#123;</div><div class="line">    // 兼容<span class="number">7.0</span>系统 uri <span class="keyword">file</span>:// 的坑</div><div class="line">    <span class="keyword">if</span> (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.N) &#123;</div><div class="line">        <span class="keyword">File</span> <span class="keyword">file</span> = new <span class="keyword">File</span>(filePath);</div><div class="line">        <span class="keyword">intent</span>.addFlags(<span class="keyword">Intent</span>.FLAG_GRANT_READ_URI_PERMISSION);</div><div class="line">        <span class="keyword">intent</span>.addFlags(<span class="keyword">Intent</span>.FLAG_GRANT_WRITE_URI_PERMISSION);</div><div class="line">        <span class="keyword">final</span> String packageName = context.getPackageName();</div><div class="line">        <span class="keyword">final</span> String authority =  new StringBuilder(packageName).append(<span class="string">".provider"</span>).toString();</div><div class="line">        <span class="keyword">return</span> FileProvider.getUriForFile(context, authority, <span class="keyword">file</span>);</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        <span class="keyword">return</span> Uri.parse(<span class="string">"file://"</span> + filePath);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>这时，你肯定要问为什么之前拍照的时候不用<code>addFlag</code>的方式呢？</p><p>哈哈，这位同学你的问题问的很到位呀。</p><p>因为addFlags主要用于setData，setDataAndType以及setClipData（注意：4.4时，并没有将ACTION_IMAGE_CAPTURE转为setClipData实现）这种方式。</p><p>所以addFlags方式对于ACTION_IMAGE_CAPTURE在5.0以下是无效的，所以需要使用grantUriPermission，如果是正常的通过setData分享的uri，使用addFlags是没有问题的（可以写个简单的例子测试下）</p><p>这时候，你又会问了，为什么拍照的时候没有设置就没有报错呢？</p><p>哈哈，这位同学你的问题好多呀。</p><p>拍照的时候， intent的action是<code>ACTION_IMAGE_CAPTURE</code>,startActivity后会调用 <code>intent.migrateExtraStreamToClipData();</code>方法。</p><p>在21之后，会有这段逻辑 (ps: 不要问我怎么知道的)</p><figure class="highlight cs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span> (MediaStore.ACTION_IMAGE_CAPTURE.<span class="keyword">equals</span>(action)</div><div class="line">        || MediaStore.ACTION_IMAGE_CAPTURE_SECURE.<span class="keyword">equals</span>(action)</div><div class="line">        || MediaStore.ACTION_VIDEO_CAPTURE.<span class="keyword">equals</span>(action)) &#123;</div><div class="line">    final Uri output;</div><div class="line">    <span class="keyword">try</span> &#123;</div><div class="line">        output = getParcelableExtra(MediaStore.EXTRA_OUTPUT);</div><div class="line">    &#125; <span class="keyword">catch</span> (ClassCastException e) &#123;</div><div class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span> (output != <span class="literal">null</span>) &#123;</div><div class="line">        setClipData(ClipData.newRawUri(<span class="string">""</span>, output));</div><div class="line">        addFlags(FLAG_GRANT_WRITE_URI_PERMISSION|FLAG_GRANT_READ_URI_PERMISSION);</div><div class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="selector-tag">cameraIntent</span><span class="selector-class">.putExtra</span>(<span class="selector-tag">MediaStore</span><span class="selector-class">.EXTRA_OUTPUT</span>, <span class="selector-tag">mCameraCaptureURI</span>);</div></pre></td></tr></table></figure><p>看到这里就会知道它会直接给我们添加权限。（在 21 之后）</p><h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p> android 7.0 变更还有其他的变更，比如多窗口支持、屏幕缩放等。和我们关系最大的就是这个了。你可以将其写在一个工具类里面，有利于代码的优化，这里有鸿洋大神的例子<a href="https://github.com/hongyangAndroid/FitAndroid7" target="_blank" rel="external">FitAndroid7</a>可以学习一下</p>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;一、简述&quot;&gt;&lt;a href=&quot;#一、简述&quot; class=&quot;headerlink&quot; title=&quot;一、简述&quot;&gt;&lt;/a&gt;一、简述&lt;/h3&gt;&lt;p&gt;之前在做拍照功能的时候，在7.0系统的手机上会出现问题，在看了看官网的&lt;a href=&quot;https://developer.android.com/about/versions/nougat/android-7.0-changes.html&quot;&gt;Android 7.0行为变更&lt;/a&gt;,才知道问题出在了哪里，适配的话必须去除项目中传递&lt;code&gt;file://&lt;/code&gt;类似格式的uri了。&lt;br&gt;
    
    </summary>
    
    
      <category term="Android" scheme="https://lennyup.github.io/tags/Android/"/>
    
  </entry>
  
  <entry>
    <title>消息传递机制之EventBus</title>
    <link href="https://lennyup.github.io/2017/05/05/eventbus-first/"/>
    <id>https://lennyup.github.io/2017/05/05/eventbus-first/</id>
    <published>2017-05-05T09:17:52.000Z</published>
    <updated>2017-10-11T06:14:50.000Z</updated>
    
    <content type="html"><![CDATA[<p>每天进步一点，没准哪天自己也会成为大佬呢。</p><p>现在，我开始研究最近特别火的消息传递机制<code>EventBus</code>.以前，对于<code>activity</code>和<code>fragment</code>之间的通信可以用接口回调的方式实现，使用起来会略有些麻烦。现在可以用<code>EventBus</code>，好用简单。</p><p>官方说明是这样定义的：<code>EventBus</code>是针对<code>Android</code>的发布／订阅事件总线。轻松实现各个组件之间的传递消息，可读性高，耦合度低。下面以<code>3.0</code>为例，学习和记录下其使用。<br><a id="more"></a></p><h3 id="使用EventBus的三个步骤"><a href="#使用EventBus的三个步骤" class="headerlink" title="使用EventBus的三个步骤"></a>使用EventBus的三个步骤</h3><h4 id="定义事件"><a href="#定义事件" class="headerlink" title="定义事件"></a>定义事件</h4><figure class="highlight haxe"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MessageEvent</span> </span>&#123;</div><div class="line">    <span class="keyword">public</span> final <span class="keyword">String</span> message;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> MessageEvent(<span class="keyword">String</span> message) &#123;</div><div class="line">        <span class="built_in">this</span>.message = message;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><h4 id="准备订阅者"><a href="#准备订阅者" class="headerlink" title="准备订阅者"></a>准备订阅者</h4><p>订阅者实现事件处理方法，在事件发布时被调用。被调用的方法要用<code>@Subscribe</code>注释。<br>（在3.0 中可以自由选择方法名）</p><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Subscribe</span>(threadMode = ThreadMode.MAIN)</div><div class="line"> <span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">freshed</span><span class="params">(utils.MessageEvent messageEvent)</span> </span>&#123;</div><div class="line">     Log.d(<span class="string">"MainActivity"</span>, <span class="string">"_------------------MainActivity"</span>);</div><div class="line"> &#125;</div></pre></td></tr></table></figure><h5 id="注册订阅以及取消订阅"><a href="#注册订阅以及取消订阅" class="headerlink" title="注册订阅以及取消订阅"></a>注册订阅以及取消订阅</h5><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">onStart</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">super</span>.onStart();</div><div class="line">    EventBus.getDefault().register(<span class="keyword">this</span>);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">onStop</span><span class="params">()</span> </span>&#123;</div><div class="line">    EventBus.getDefault().unregister(<span class="keyword">this</span>);</div><div class="line">    <span class="keyword">super</span>.onStop();</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>官方上是在<code>onStop</code>中取消订阅，个人建议在<code>onDestroy</code>中。</p><h4 id="发布事件"><a href="#发布事件" class="headerlink" title="发布事件"></a>发布事件</h4><figure class="highlight haxe"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">EventBus.getDefault().post(<span class="keyword">new</span> <span class="type">MessageEvent</span>(<span class="string">"Hello!"</span>));</div></pre></td></tr></table></figure><h3 id="切换线程"><a href="#切换线程" class="headerlink" title="切换线程"></a>切换线程</h3><p><code>EventBus</code>可以简单的实现线程间的切换，其中包括后台线程、主线程（UI线程）、异步线程。</p><h4 id="POSTING"><a href="#POSTING" class="headerlink" title="POSTING"></a>POSTING</h4><p>默认调用方式，在调用post方法的线程执行，避免了线程切换，性能开销最少   </p><figure class="highlight cs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// Called in the same thread (default)</span></div><div class="line"><span class="comment">// ThreadMode is optional here</span></div><div class="line">@Subscribe(threadMode = ThreadMode.POSTING)</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onMessage</span>(<span class="params">MessageEvent <span class="keyword">event</span></span>) </span>&#123;</div><div class="line">    log(<span class="keyword">event</span>.message);</div><div class="line">&#125;</div></pre></td></tr></table></figure><h4 id="MAIN"><a href="#MAIN" class="headerlink" title="MAIN"></a>MAIN</h4><p> 主线程（UI线程）</p><figure class="highlight cs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// Called in Android UI's main thread</span></div><div class="line">@Subscribe(threadMode = ThreadMode.MAIN)</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onMessage</span>(<span class="params">MessageEvent <span class="keyword">event</span></span>) </span>&#123;</div><div class="line">textField.setText(<span class="keyword">event</span>.message);</div><div class="line">&#125;</div></pre></td></tr></table></figure><h4 id="BACKGROUND"><a href="#BACKGROUND" class="headerlink" title="BACKGROUND"></a>BACKGROUND</h4><p>后台线程。这个会分两种情况：如果post的线程不是主线程，就在当前线程中调用。如果是主线程， EventBus 就会使用一个单独的后台线程来顺序发送所有的事件。</p><figure class="highlight cs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// Called in the background thread</span></div><div class="line">@Subscribe(threadMode = ThreadMode.BACKGROUND)</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onMessage</span>(<span class="params">MessageEvent <span class="keyword">event</span></span>)</span>&#123;</div><div class="line">    saveToDisk(<span class="keyword">event</span>.message);</div><div class="line">&#125;</div></pre></td></tr></table></figure><h4 id="ASYNC"><a href="#ASYNC" class="headerlink" title="ASYNC"></a>ASYNC</h4><p>异步线程，通常用来执行比较耗时的操作，比如网络请求<br>EventBus内部使用了线程池，但是要尽量避免大量长时间运行的异步线程，限制并发线程数量可以通过EventBusBuilder修改，默认使用Executors.newCachedThreadPool()</p><figure class="highlight cs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// Called in a separate thread</span></div><div class="line">@Subscribe(threadMode = ThreadMode.ASYNC)</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onMessage</span>(<span class="params">MessageEvent <span class="keyword">event</span></span>)</span>&#123;</div><div class="line">    backend.send(<span class="keyword">event</span>.message);</div><div class="line">&#125;</div></pre></td></tr></table></figure><h3 id="EventBusBuilder配置"><a href="#EventBusBuilder配置" class="headerlink" title="EventBusBuilder配置"></a>EventBusBuilder配置</h3><p>EventBus提供了许多配置，方便我们实现不同的需求。</p><figure class="highlight pony"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="type">EventBus</span> eventBus = <span class="function"><span class="keyword">new</span> <span class="title">EventBus</span>();</span></div><div class="line">    <span class="comment">//下面这一条的效果是完全一样的</span></div><div class="line">    <span class="title">EventBus</span> <span class="title">eventBus</span> = <span class="title">EventBus</span>.<span class="title">builder</span>().<span class="title">build</span>();</div><div class="line">    <span class="comment">//修改默认实现的配置，记住，必须在第一次EventBus.getDefault()之前配置，且只能设置一次。建议在application.onCreate()调用</span></div><div class="line">    <span class="title">EventBus</span>.<span class="title">builder</span>().<span class="title">throwSubscriberException</span>(<span class="type">BuildConfig</span>.<span class="type">DEBUG</span>).<span class="title">installDefaultEventBus</span>();</div></pre></td></tr></table></figure><h3 id="StickyEvent"><a href="#StickyEvent" class="headerlink" title="StickyEvent"></a>StickyEvent</h3><p>粘性事件类似粘性广告，就是一次注册永久使用的那种。<br>使用的方式是：发送时采用postSticky</p><figure class="highlight haxe"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">EventBus.getDefault().postSticky(<span class="keyword">new</span> <span class="type">MessageEvent</span>(<span class="string">"Hello everyone!"</span>));</div></pre></td></tr></table></figure><p>接受时添加一个sticky = true</p><figure class="highlight cs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// UI updates must run on MainThread</span></div><div class="line">@Subscribe(sticky = <span class="literal">true</span>, threadMode = ThreadMode.MAIN)</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onEvent</span>(<span class="params">MessageEvent <span class="keyword">event</span></span>) </span>&#123;   </div><div class="line">    textField.setText(<span class="keyword">event</span>.message);</div><div class="line">&#125;</div></pre></td></tr></table></figure><h4 id="清除粘性事件"><a href="#清除粘性事件" class="headerlink" title="清除粘性事件"></a>清除粘性事件</h4><figure class="highlight smali"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">MessageEvent stickyEvent = EventBus.getDefault().getStickyEvent(MessageEvent.class);</div><div class="line">// Better<span class="built_in"> check </span>that an event was actually posted before</div><div class="line">if(stickyEvent != null) &#123;</div><div class="line">    // <span class="string">"Consume"</span> the sticky event</div><div class="line">    EventBus.getDefault().removeStickyEvent(stickyEvent);</div><div class="line">    // Now do something with it</div><div class="line">&#125;</div></pre></td></tr></table></figure><h3 id="优先事项和事件取消"><a href="#优先事项和事件取消" class="headerlink" title="优先事项和事件取消"></a>优先事项和事件取消</h3><h4 id="用户优先级"><a href="#用户优先级" class="headerlink" title="用户优先级"></a>用户优先级</h4><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// priority越大，级别越高，默认是0</span></div><div class="line"><span class="comment">// 不影响具有不同线程的订阅者之间的顺序</span></div><div class="line"><span class="meta">@Subscribe</span>(priority = <span class="number">1</span>);</div><div class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">onEvent</span><span class="params">(MessageEvent event)</span> </span>&#123;</div><div class="line">    ...</div><div class="line">&#125;</div></pre></td></tr></table></figure><h4 id="取消事件传递"><a href="#取消事件传递" class="headerlink" title="取消事件传递"></a>取消事件传递</h4><figure class="highlight cs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 中止事件传递，后续事件不在调用,注意，只能在传递事件的时候调用</span></div><div class="line"><span class="comment">// Called in the same thread (default)</span></div><div class="line">@<span class="function">Subscribe</span></div><div class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onEvent</span>(<span class="params">MessageEvent <span class="keyword">event</span></span>)&#123;</div><div class="line">    <span class="comment">// Process the event</span></div><div class="line">    ...</div><div class="line">    <span class="comment">// Prevent delivery to other subscribers</span></div><div class="line">    EventBus.getDefault().cancelEventDelivery(<span class="keyword">event</span>) ;</div><div class="line">&#125;</div></pre></td></tr></table></figure><h3 id="用户索引"><a href="#用户索引" class="headerlink" title="用户索引"></a>用户索引</h3><p>这个是3的一个新功能。它是可选的优化，可加速初始化用户注册。</p><p>要启用索引生成，需要用<code>annotationprocessor</code>属性将EventBus注释处理器添加到构建中。还设置一个参数<code>eventBusIndex</code>来指定生成的索引的完全限定类。例如：</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="section">android</span> &#123;</div><div class="line"><span class="section">defaultConfig</span> &#123;</div><div class="line"><span class="section">javaCompileOptions</span> &#123;</div><div class="line"><span class="section">annotationProcessOptions</span> &#123;</div><div class="line"><span class="attribute">arguments</span> = [ eventBusIndex : <span class="string">'com.example.myapp.MyEventBusIndex'</span> ]</div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">dependencies &#123;</div><div class="line"><span class="attribute">compile</span> <span class="string">'org.greenrobot:eventbus:3.0.0'</span></div><div class="line">annotationProcessor <span class="string">'org.greenrobot:eventbus-annotation-processor:3.0.1'</span></div><div class="line">&#125;</div></pre></td></tr></table></figure><p>也可以用 apt 的形式：</p><p>ps:由于apt的限制，匿名内部类中的annotation不会被识别，会自动降级在运行时反射，此时，效率会降低</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="section">buildscript</span> &#123;</div><div class="line">    <span class="section">dependencies</span> &#123;</div><div class="line">        <span class="attribute">classpath</span> <span class="string">'com.neenbedankt.gradle.plugins:android-apt:1.8'</span></div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">apply plugin: <span class="string">'com.neenbedankt.android-apt'</span></div><div class="line"></div><div class="line">dependencies &#123;</div><div class="line">    <span class="attribute">compile</span> <span class="string">'org.greenrobot:eventbus:3.0.0'</span></div><div class="line">    apt <span class="string">'org.greenrobot:eventbus-annotation-processor:3.0.1'</span></div><div class="line">&#125;</div><div class="line"></div><div class="line">apt &#123;</div><div class="line">    <span class="section">arguments</span> &#123;</div><div class="line">        <span class="attribute">eventBusIndex</span> <span class="string">"com.example.myapp.MyEventBusIndex"</span></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>设置EventBus传递它如下：</p><figure class="highlight pony"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="type">EventBus</span> eventBus = <span class="type">EventBus</span>.builder().addIndex(<span class="function"><span class="keyword">new</span> <span class="title">MyEventBusIndex</span>()).<span class="title">build</span>();</span></div></pre></td></tr></table></figure><p>或者使用默认实例：</p><figure class="highlight smali"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">EventBus.builder().addIndex(new MyEventBusIndex()).installDefaultEventBus();</div><div class="line">// Now the default<span class="built_in"> instance </span>uses the given index. Use it like this:</div><div class="line">EventBus eventBus = EventBus.getDefault();</div></pre></td></tr></table></figure><h3 id="混淆"><a href="#混淆" class="headerlink" title="混淆"></a>混淆</h3><figure class="highlight crystal"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">-keepattributes *Annotation*</div><div class="line">-keepclassmembers <span class="class"><span class="keyword">class</span> ** &#123;</span></div><div class="line">    @org.greenrobot.eventbus.Subscribe &lt;methods&gt;;</div><div class="line">&#125;</div><div class="line">-keep <span class="class"><span class="keyword">enum</span> <span class="title">org</span>.<span class="title">greenrobot</span>.<span class="title">eventbus</span>.<span class="title">ThreadMode</span> &#123; *;</span> &#125;</div><div class="line"></div><div class="line"><span class="comment"># Only required if you use AsyncExecutor</span></div><div class="line">-keepclassmembers <span class="class"><span class="keyword">class</span> * <span class="title">extends</span> <span class="title">org</span>.<span class="title">greenrobot</span>.<span class="title">eventbus</span>.<span class="title">util</span>.<span class="title">ThrowableFailureEvent</span> &#123;</span></div><div class="line">    &lt;init&gt;(java.lang.Throwable);</div><div class="line">&#125;</div></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;每天进步一点，没准哪天自己也会成为大佬呢。&lt;/p&gt;
&lt;p&gt;现在，我开始研究最近特别火的消息传递机制&lt;code&gt;EventBus&lt;/code&gt;.以前，对于&lt;code&gt;activity&lt;/code&gt;和&lt;code&gt;fragment&lt;/code&gt;之间的通信可以用接口回调的方式实现，使用起来会略有些麻烦。现在可以用&lt;code&gt;EventBus&lt;/code&gt;，好用简单。&lt;/p&gt;
&lt;p&gt;官方说明是这样定义的：&lt;code&gt;EventBus&lt;/code&gt;是针对&lt;code&gt;Android&lt;/code&gt;的发布／订阅事件总线。轻松实现各个组件之间的传递消息，可读性高，耦合度低。下面以&lt;code&gt;3.0&lt;/code&gt;为例，学习和记录下其使用。&lt;br&gt;
    
    </summary>
    
    
      <category term="Android" scheme="https://lennyup.github.io/tags/Android/"/>
    
  </entry>
  
  <entry>
    <title>几种开源协议的简要分析</title>
    <link href="https://lennyup.github.io/2017/04/21/choose-license/"/>
    <id>https://lennyup.github.io/2017/04/21/choose-license/</id>
    <published>2017-04-21T06:12:46.000Z</published>
    <updated>2017-10-11T06:14:43.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><p>最近闲来无事，在github上看到许多大佬项目中所用到的开源协议，一直对开源协议的使用比较模糊，在这里，对其做下简要说明。</p><h3 id="开源协议"><a href="#开源协议" class="headerlink" title="开源协议"></a>开源协议</h3><p>这里只介绍几个主要的开源协议–<code>GPL</code>、<code>BSD</code>、<code>MIT</code>、<code>Mozilla</code>、<code>Apache</code>、<code>LGPl</code>。<br><a id="more"></a><br>乌克兰程序员 Paul Bagwell画了一个分析图，说明该如何选择自己所需要的开源协议，我引用下 阮一峰大牛的图：</p><p><img src="http://image.beekka.com/blog/201105/bg2011050101.png" alt=""></p><p>还有来自其他大佬的表格图解</p><p><img src="http://static.oschina.net/uploads/img/201607/07112930_GNOM.png" alt=""></p><h4 id="BSD"><a href="#BSD" class="headerlink" title="BSD"></a>BSD</h4><p>BSD开源协议是一个给予使用者很大自由的协议。使用者可以修改源代码，也可以将修改后的源代码作为开源或者专用软件再发布。</p><p>但是当你使用BSD协议的代码，或者以BSD协议代码为基础做二次开发自己的产品时，需要满足三个条件：</p><ul><li>如果再发布的产品中包含源代码，则在源代码中必须带有原来代码的BSD协议。</li><li>如果再发布的只是二进制类库／软件。则需要再类库／软件的文档和版权声明中包含原来代码中的BSD协议。</li><li>不可以用开源代码的作者／机构名字和原来产品的名字做市场推广。</li></ul><p>BSD 代码鼓励代码共享，但需要尊重代码作者的著作权。BSD由于允许使用者修改和重新发布代码，也允许使用或在BSD代码上开发商业软件发布和销售，因此是对 商业集成很友好的协议。而很多的公司企业在选用开源产品的时候都首选BSD协议，因为可以完全控制这些第三方的代码，在必要的时候可以修改或者二次开发。</p><h4 id="Apache-Licence-2-0"><a href="#Apache-Licence-2-0" class="headerlink" title="Apache Licence 2.0"></a>Apache Licence 2.0</h4><p>Apache Lincence是著名的非盈利开源组织Apache采用的协议。和BSD类似，同样鼓励代码共享和尊重愿坐着的著作权，同样允许代码修改。需要满足的条件如下：</p><ul><li>需要给代码的用户一份Apache Licence</li><li>如果你修改代码，需要再被修改的文件中说明</li><li>在延伸的代码中需要带有原来代码中的协议，商标，专利声明和其他原来坐着规定需要包含的说明。</li><li>如果再发布的铲平中包含一个Notice文件，则在Notice文件中需要带有 Apache Licence。你可以再Notice中增加自己的许可，单不可以表现为对Apache Licence构成更改。</li></ul><h4 id="GPL"><a href="#GPL" class="headerlink" title="GPL"></a>GPL</h4><p>GPL协议和BSD，APache Licence等鼓励代码重用的许可不一样。它的出发点是代码的开源／免费使用和引用／修改／衍生代码的开源／免费使用。但不允许秀发后和衍生的代码作为闭源的商业软件发布和销售。这也是为什么我们能用免费的各种Linux（Linux 就是采用GPL协议），包括商业公司的linux和linux上各种各样的有个人，组织，以及商业软件公司开发的免费软件了。</p><p>GPL协议的主要内容是只要一个软件中使用GPL协议的产品，则该软件必须也采用GPL协议，必须也是开源和免费。这就是所谓的 “传染性”。GPL协议的产品作为一个单独的产品使用没有任何问题，还可以享受免费的优势。</p><p>由于GPL的严格要求，商业软件或者对代码有保密要求的部门就不适合继承／采用作为类库和二次开发的基础。</p><p>在发布的时候需要伴随GPL协议等和BSD／Apache等类似。</p><h4 id="LGPL"><a href="#LGPL" class="headerlink" title="LGPL"></a>LGPL</h4><p>LGPL是GPL的一个为主要类库使用设计的开源协议。和GPL要求任何使用／修改／衍生之GPL类库的软件必须采用GPL协议不同。LGPL允许商业软件通过类库引用（link）方式使用LGPL类库而不需要开源商业软件的代码。这使得采用LGPL协议的开源代码可以被商业如那件作为类库引用病发布和销售。</p><p>但是如果修改LGPL协议的代码或者衍生，则所有修改的代码，涉及修改部分的额外代码和衍生的代码都必须采用LGPL协议。因 此LGPL协议的开源 代码很适合作为第三方类库被商业软件引用，但不适合希望以LGPL协议代码为基础，通过修改和衍生的方式做二次开发的商业软件采用。</p><p>GPL/LGPL都保障原作者的知识产权，避免有人利用开源代码复制并开发类似的产品。</p><h4 id="MIT"><a href="#MIT" class="headerlink" title="MIT"></a>MIT</h4><p>MIT是和BSD一样宽范的许可协议，作者只想保留版权，而无任何其他了限制。也就是说，你必须在你的发行版里包含原许可协议的声明，无论你是以二进制发布的还是以源代码发布的。</p><h4 id="MPL（Mozilla-Public-License）"><a href="#MPL（Mozilla-Public-License）" class="headerlink" title="MPL（Mozilla Public License）"></a>MPL（Mozilla Public License）</h4><p>MPL既是得到自由软件基金会承认的自由软件许可证，也是得到开放源代码促进会承认的开源软件许可证。MPL允许在其授权下的源代码与其他授权的文件进行混合，包括私有许可证。但在MPL授权下的代码文件必须保持MPL授权，并且保持开源。</p><p>这样让MPL既不像MIT和BSD那样允许派生作品完全转化为私有，也不像GPL那样要求所有的派生作品，包括新的组件在内，全部必须保持GPL。通过允许在派生项目中存在私有模块，同时保证核心文件的开源，MPL同时激励了商业及开源社区来参与帮助开发核心软件。</p><p>使用MPL授权的软件并不受专利的限制，其可以自由使用，修改，并可自由的重新发布。带有专利代码的版本仍然可以使用，转让，甚至出售，但未经许可则不能修改代码。此外，MPL并不授予用户对于开发者商标的使用权。<br>为了满足MPL的条款限制，用户必须负担一些“责任”，主要是关于散发使用MPL授权的软件。用户必须确保重新散发的软件所有源代码均以MPL授权，即使是以可执行文件的方式提供或是与其他使用专有软件授权的源代码结合也一样。但若跟以GNU通用公共许可协议、GNU宽通用公共许可证、Affero通用公共许可证授权的源代码结合则是例外。此时开发者则可选用以上三种更加严格的条款来授权。</p><h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>几种协议各有利弊，一般大佬们喜欢用<code>Apache</code>和 <code>MIT</code>。（ps：大佬们果然懂的多，站在巨人的肩膀上才能看的更远）</p>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;前言&quot;&gt;&lt;a href=&quot;#前言&quot; class=&quot;headerlink&quot; title=&quot;前言&quot;&gt;&lt;/a&gt;前言&lt;/h3&gt;&lt;p&gt;最近闲来无事，在github上看到许多大佬项目中所用到的开源协议，一直对开源协议的使用比较模糊，在这里，对其做下简要说明。&lt;/p&gt;
&lt;h3 id=&quot;开源协议&quot;&gt;&lt;a href=&quot;#开源协议&quot; class=&quot;headerlink&quot; title=&quot;开源协议&quot;&gt;&lt;/a&gt;开源协议&lt;/h3&gt;&lt;p&gt;这里只介绍几个主要的开源协议–&lt;code&gt;GPL&lt;/code&gt;、&lt;code&gt;BSD&lt;/code&gt;、&lt;code&gt;MIT&lt;/code&gt;、&lt;code&gt;Mozilla&lt;/code&gt;、&lt;code&gt;Apache&lt;/code&gt;、&lt;code&gt;LGPl&lt;/code&gt;。&lt;br&gt;
    
    </summary>
    
    
      <category term="github" scheme="https://lennyup.github.io/tags/github/"/>
    
  </entry>
  
  <entry>
    <title>浅析builder模式</title>
    <link href="https://lennyup.github.io/2017/04/20/android-builder/"/>
    <id>https://lennyup.github.io/2017/04/20/android-builder/</id>
    <published>2017-04-20T02:56:26.000Z</published>
    <updated>2017-10-11T06:14:24.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><p>其实，我很早就想总结一下自己多熟悉的设计模式，一直找不到合适的切入点来写。最近看到 <code>AlertDialog</code>,心想这不就是一个活生生的<code>Builder</code>模式的例子吗，于是乎，我赶紧敲了敲自己昏昏欲睡的脑袋，<br>抓住自己呼之欲出的灵感，奋笔疾书！<br><a id="more"></a></p><h3 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h3><p>建造者模式: 将一个复杂对象的构建与它的表示分离，使得同样的构建过程可以创建不同的表示。</p><p>举个栗子：大学生去食堂打饭，可以选四菜一汤，菜系任意选，那么打饭的这个过程 和他出来的不同搭配 就需要进行分离。</p><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">AlertDialog.<span class="keyword">Builder </span><span class="keyword">builder=new</span></div><div class="line">                AlertDialog.<span class="keyword">Builder(this)</span></div><div class="line">                .setTitle(<span class="string">"My Dialog"</span>)</div><div class="line">                .setMessage(<span class="string">"This is Test Dialog"</span>)</div><div class="line">                .setIcon(R.drawable.icon)<span class="comment">;</span></div><div class="line">        AlertDialog <span class="keyword">dialog=builder.create();</span></div></pre></td></tr></table></figure><p>如上面的代码，我们不是通过 new 的方式来直接创建一个对象。而是通过其Builder 来配置，然后再<code>create</code>出来。</p><h3 id="Builder模式"><a href="#Builder模式" class="headerlink" title="Builder模式"></a>Builder模式</h3><p>下面我们通过看<code>AlertDialog</code> 的源码来解析下 <code>Builder</code> 模式，<br>先来看下它的构造方法：</p><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">protected</span> <span class="title">AlertDialog</span><span class="params">(Context context)</span> </span>&#123;</div><div class="line">     <span class="keyword">super</span>((Context)<span class="keyword">null</span>, <span class="keyword">false</span>, (OnCancelListener)<span class="keyword">null</span>);</div><div class="line">     <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"Stub!"</span>);</div><div class="line"> &#125;</div></pre></td></tr></table></figure><p>可以看出来，方法的修饰是<code>protected</code> ,也就是说除了它的子类之外，其他类无法访问这个方法，所以这就不能直接创建<code>AlertDialog</code>的实例了，只能通过<code>Builder</code>的方式。</p><p>我们来看下<code>Builder</code>的代码：</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">        <span class="keyword">public</span> static <span class="class"><span class="keyword">class</span> <span class="title">Builder</span> </span>&#123;</div><div class="line">        <span class="keyword">private</span> <span class="keyword">final</span> AlertController.AlertParams P;</div><div class="line"></div><div class="line">        <span class="keyword">public</span> Builder(<span class="meta">@NonNull</span> Context context) &#123;</div><div class="line">            <span class="keyword">this</span>(context, resolveDialogTheme(context, <span class="number">0</span>));</div><div class="line">        &#125;</div><div class="line">...</div><div class="line">        <span class="keyword">public</span> Builder setTitle(<span class="meta">@Nullable</span> CharSequence title) &#123;</div><div class="line">            P.mTitle = title;</div><div class="line">            <span class="keyword">return</span> <span class="keyword">this</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">public</span> Builder setMessage(<span class="meta">@Nullable</span> CharSequence message) &#123;</div><div class="line">            P.mMessage = message;</div><div class="line">            <span class="keyword">return</span> <span class="keyword">this</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">public</span> Builder setIcon(<span class="meta">@DrawableRes</span> int iconId) &#123;</div><div class="line">            P.mIconId = iconId;</div><div class="line">            <span class="keyword">return</span> <span class="keyword">this</span>;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">    .....</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>这里只是其中的一部分，具体的可以去阅读下它的源码，在这里可以看出，<code>Builder</code>是<code>AlertDialog</code>的一个静态内部类，这里就列出了三个方法<br>用于分别设置其信息，标题和图标。这里的重点在于没个方法的返回值都是其自身。这样可以便利的设置自己的配置，也切法呦逻辑感。</p><p>来看下 <code>create</code>方法的实现：</p><figure class="highlight sqf"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">public AlertDialog create() &#123;</div><div class="line">     <span class="comment">// Context has already been wrapped with the appropriate theme.</span></div><div class="line">     final AlertDialog <span class="built_in">dialog</span> = new AlertDialog(P.mContext, <span class="number">0</span>, <span class="literal">false</span>);</div><div class="line">     P.<span class="built_in">apply</span>(<span class="built_in">dialog</span>.mAlert);</div><div class="line">     <span class="built_in">dialog</span>.setCancelable(P.mCancelable);</div><div class="line">     <span class="keyword">if</span> (P.mCancelable) &#123;</div><div class="line">         <span class="built_in">dialog</span>.setCanceledOnTouchOutside(<span class="literal">true</span>);</div><div class="line">     &#125;</div><div class="line">     <span class="built_in">dialog</span>.setOnCancelListener(P.mOnCancelListener);</div><div class="line">     <span class="built_in">dialog</span>.setOnDismissListener(P.mOnDismissListener);</div><div class="line">     <span class="keyword">if</span> (P.mOnKeyListener != null) &#123;</div><div class="line">         <span class="built_in">dialog</span>.setOnKeyListener(P.mOnKeyListener);</div><div class="line">     &#125;</div><div class="line">     return <span class="built_in">dialog</span>;</div><div class="line"> &#125;</div></pre></td></tr></table></figure><p>最后，通过我们之前的配置，关联到我们现在创建的这个实例上来。完成创建。</p><p>还有其他的地方也用到了了<code>Builder</code>模式，比如说 OkHttp里的<code>Request.Builder</code>.</p><h3 id="使用场景"><a href="#使用场景" class="headerlink" title="使用场景"></a>使用场景</h3><ul><li><p>当创建复杂对象的算法应该独立于该对象的组成部分以及它们的装配方式时。</p></li><li><p>当构造过程必须允许被构造的对象有不同的表示时。</p></li><li><p>Builder模式要解决的也正是这样的问题：</p></li></ul><p>　　- 当我们要创建的对象很复杂的时候（通常是由很多其他的对象组合而成），</p><p>　　- 我们要复杂对象的创建过程和这个对象的表示（展示）分离开来，<br>这样做的好处就是通过一步步的进行复杂对象的构建，</p><p>　　- 由于在每一步的构造过程中可以引入参数，使得经过相同的步骤创建最后得到的对象的展示不一样。</p><h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>这里只是简单的从 Android的角度去分析<code>Builder</code>模式，简化了很多，<code>Builder</code>模式的使用并不会使我们的代码运行速度加快。设计模式总的来说就是对是封装、继承、多态和关联的反复使用；是一种编程技巧，让我们能写出高质量代码的技巧。</p>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;前言&quot;&gt;&lt;a href=&quot;#前言&quot; class=&quot;headerlink&quot; title=&quot;前言&quot;&gt;&lt;/a&gt;前言&lt;/h3&gt;&lt;p&gt;其实，我很早就想总结一下自己多熟悉的设计模式，一直找不到合适的切入点来写。最近看到 &lt;code&gt;AlertDialog&lt;/code&gt;,心想这不就是一个活生生的&lt;code&gt;Builder&lt;/code&gt;模式的例子吗，于是乎，我赶紧敲了敲自己昏昏欲睡的脑袋，&lt;br&gt;抓住自己呼之欲出的灵感，奋笔疾书！&lt;br&gt;
    
    </summary>
    
    
      <category term="Android" scheme="https://lennyup.github.io/tags/Android/"/>
    
  </entry>
  
  <entry>
    <title>Materal Design 之 CardView</title>
    <link href="https://lennyup.github.io/2017/04/14/cardview-first/"/>
    <id>https://lennyup.github.io/2017/04/14/cardview-first/</id>
    <published>2017-04-14T03:41:55.000Z</published>
    <updated>2017-10-11T06:14:38.000Z</updated>
    
    <content type="html"><![CDATA[<p>最近看一些大佬的自定义view，其中用到了<code>CardView</code>，感觉好高大上，赶紧去恶补一下。（我默默的打开了源码）</p><h3 id="源码解读"><a href="#源码解读" class="headerlink" title="源码解读"></a>源码解读</h3><p>首先在刚开始有这么一句话<br><code>A FrameLayout with a rounded corner background and shadow.</code></p><p><code>CardView</code>是一个带圆角、带阴影效果的<code>FrameLayout</code>（原来如此）<br><a id="more"></a><br>接下来第二句</p><p><code>CardView uses &lt;code&gt;elevation&lt;/code&gt; property on Lollipop for shadows and falls back to a custom emulated shadow implementation on older platforms.</code></p><p>它是使用的 <code>elevation</code>这个属性来控制阴影效果的大小，成正比的。</p><figure class="highlight avrasm"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="symbol">app:</span>cardElevation=<span class="string">"2dp"</span></div></pre></td></tr></table></figure><p><code>Due to expensive nature of rounded corner clipping, on platforms before Lollipop, CardView does not clip its children that intersect with rounded corners. Instead, it adds padding to avoid such intersection (See {@link #setPreventCornerOverlap(boolean)} to change this behavior).</code></p><p> 在5.0版本之前圆角的裁剪是比较麻烦的，所以 CardView不会裁剪那些和圆角相关的子空间。但是用一种方法避免了这样的交集，那就是 padding（可以去看setPreventCornerOverlap(boolean) 来改变这些行为）</p><p><code>Before Lollipop, CardView adds padding to its content and draws shadows to that area. This padding amount is equal to &lt;code&gt;maxCardElevation + (1 - cos45) * cornerRadius&lt;/code&gt; on thesides and &lt;code&gt;maxCardElevation * 1.5 + (1 - cos45) * cornerRadius&lt;/code&gt; on top and bottom.</code></p><p> 在5.0之前，<code>CardView</code>为其显示的内容以及阴影效果增加了padding。在<code>sides</code>处padding值等于<code>maxCardElevation + (1 - cos45) * cornerRadius</code>, 在<code>top</code>和<code>bottom</code>处等于<code>maxCardElevation * 1.5 + (1 - cos45) * cornerRadius</code></p><p><code>Since padding is used to offset content for shadows, you cannot set padding on CardView. Instead, you can use content padding attributes in XML or {@link #setContentPadding(int, int, int, int)} in code to set the padding between the edges of the CardView and children of CardView.</code></p><p>padding是用来抵消阴影的，你不能在<code>CardView</code>上设置<code>padding</code>。你可以用 content padding属性或者在代码中通过<code>setContentPadding(int, int, int, int)</code>来设置Card和CardView的子控件之间的padding；</p><p><code>Note that, if you specify exact dimensions for the CardView, because of the shadows, its contentarea will be different between platforms before Lollipop and after Lollipop. By using api versionspecific resource values, you can avoid these changes. Alternatively, If you want CardView to add inner padding on platforms Lollipop and after as well, you can call {@link #setUseCompatPadding(boolean)} and pass &lt;code&gt;true&lt;/code&gt;.</code></p><p> 如果你给<code>CardView</code>设置了精确的尺寸，由于阴影效果，在Android L之前和Android L之后的版本中，<code>CardView</code>中显示的<code>content</code>是有区别的。通过使用API版本的特定值，可以避免这些改变。如果你想更好的设置<code>CardView</code>的内边距在Android L和之后的版本，你可以设置<code>setUseCompatPadding(boolean)为true</code></p><p> <code>To change CardView&#39;s elevation in a backward compatible way, use {@link #setCardElevation(float)}. CardView will use elevation API on Lollipop and before Lollipop, it will change the shadow size. To avoid moving the View while shadow size is changing, shadow size is clamped by {@link #getMaxCardElevation()}. If you want to change elevationdynamically, you should call {@link #setMaxCardElevation(float)} when CardView is initialized.</code></p><p>修改<code>CardView</code>的<code>elevation</code>属性通过使用<code>setCardElevation(float)</code>。<code>CardView</code>将使用<code>elevation</code>在Android L和之前的版本，它将修改这个阴影的size。为了避免当shadow size改变的时候View的移动，shadow size不能大于<code>getMaxCardElevation()</code>。如果你想动态的修改elevation，你可以调用<code>setMaxCardElevation(float)</code>方法当CardView别初始化的时候。</p><h3 id="属性和方法"><a href="#属性和方法" class="headerlink" title="属性和方法"></a>属性和方法</h3><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">app:cardBackgroundColor=<span class="string">"#ffffff"</span>  </div><div class="line">cardView.setCardBackgroundColor(<span class="keyword">int</span>);<span class="comment">//设置CardView的background的颜色  </span></div><div class="line"></div><div class="line">app:cardCornerRadius=<span class="string">"5dp"</span>  </div><div class="line">cardView.setRadius(<span class="keyword">float</span>);<span class="comment">//设置CardView的圆角半径  </span></div><div class="line"></div><div class="line">app:cardElevation=<span class="string">"2sp"</span>  </div><div class="line">cardView.setMaxCardElevation(<span class="keyword">float</span>)//设置CardView的elevation（阴影，值越大，阴影效果越强）  </div><div class="line"></div><div class="line">app:cardMaxElevation=<span class="string">"2sp"</span>//设置CardView的最大Elevation  </div><div class="line"></div><div class="line">app:cardPreventCornerOverlap=<span class="string">"true|false"</span>  </div><div class="line">cardView.setPreventCornerOverlap(<span class="keyword">boolean</span>);<span class="comment">//在Android5.0以前的版本上防止子控件和CardView的圆角之间的重叠交接  </span></div><div class="line"></div><div class="line">app:cardUseCompatPadding=<span class="string">"true|false"</span>  </div><div class="line">cardView.setUseCompatPaddin(<span class="keyword">boolean</span>);<span class="comment">//在Android5.0和以上版本添加padding让其和之前的版本有相同的测量形式  </span></div><div class="line"></div><div class="line">app:contentPadding=<span class="string">""</span>  </div><div class="line">cardView.setContentPadding(<span class="keyword">int</span>,<span class="keyword">int</span>,<span class="keyword">int</span>,<span class="keyword">int</span>);<span class="comment">//设置Card边缘和CardView的子控件之间的内边距  </span></div><div class="line"></div><div class="line">app:contentPaddingTop=<span class="string">""</span>  </div><div class="line">app:contentPaddingBottom=<span class="string">""</span>  </div><div class="line">app:contentPaddingLeft=<span class="string">""</span>  </div><div class="line">app:contentPaddingRight=<span class="string">""</span></div></pre></td></tr></table></figure><p>至于具体的代码我这里就不贴了，很简单的，可以自己去试试（实践出真知）。</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;最近看一些大佬的自定义view，其中用到了&lt;code&gt;CardView&lt;/code&gt;，感觉好高大上，赶紧去恶补一下。（我默默的打开了源码）&lt;/p&gt;
&lt;h3 id=&quot;源码解读&quot;&gt;&lt;a href=&quot;#源码解读&quot; class=&quot;headerlink&quot; title=&quot;源码解读&quot;&gt;&lt;/a&gt;源码解读&lt;/h3&gt;&lt;p&gt;首先在刚开始有这么一句话&lt;br&gt;&lt;code&gt;A FrameLayout with a rounded corner background and shadow.&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;CardView&lt;/code&gt;是一个带圆角、带阴影效果的&lt;code&gt;FrameLayout&lt;/code&gt;（原来如此）&lt;br&gt;
    
    </summary>
    
    
      <category term="Android" scheme="https://lennyup.github.io/tags/Android/"/>
    
  </entry>
  
  <entry>
    <title>算法——初篇</title>
    <link href="https://lennyup.github.io/2017/03/20/algorithm/"/>
    <id>https://lennyup.github.io/2017/03/20/algorithm/</id>
    <published>2017-03-20T02:13:11.000Z</published>
    <updated>2017-10-11T06:14:15.000Z</updated>
    
    <content type="html"><![CDATA[<p>作为一个经常在算法课上逃课的孩子，写这个有些尴尬，因为算法真的是太枯燥了，但是作为一个程序员，算法还是一定要会的（ps：许多大公司面试的时候特爱考）。在这里，简单说下几个基本的算法。</p><p>在这之前，说下时间复杂度的概念。<br><a id="more"></a></p><h2 id="时间复杂度"><a href="#时间复杂度" class="headerlink" title="时间复杂度"></a>时间复杂度</h2><h3 id="时间频度"><a href="#时间频度" class="headerlink" title="时间频度"></a>时间频度</h3><p>时间频度：一个算法执行所耗费的时间，从理论上是不能算出来的，必须上机运行测试才知道。但是我们没有必要那么精准的数据，只需要知道哪个算法所话费的时间比较多，哪个比较少就够了。算法的所花费的时间是和它执行的次数成正比的，这样我们只需要关系次数就好了。一个算法中的语句执行次数被称为语句频度或时间频度。记为<code>T(n)</code></p><h3 id="时间复杂度-1"><a href="#时间复杂度-1" class="headerlink" title="时间复杂度"></a>时间复杂度</h3><p>在刚才提到的时间频度中，n称为问题的规模，当n不断变化时没时间频度T(n)也会不断变化。但有时我们想知道它变化时呈现什么规律。为此，我们引入了时间复杂度的概念。一般情况下，算法中基本操作重复执行的次数时问题规模n的某个函数，用T(n)表示，若有某个辅助函数<code>f(n)</code>，使得当<code>n</code>近于无限大时，<code>T(n)f(n)</code>的极限为不等于零的常数，则称为<code>f(n)是T(n)的同数量级函数</code>。记作<code>T(n)=O(f(n))</code>,称<code>O(f(n))</code>为算法的渐进时间复杂度，简称时间复杂度。</p><p>   时间频度不同，但时间复杂度可能相同。如：T(n)=n2+3n+4与T(n)=4n2+2n+1它们的频度不同，但时间复杂度相同，都为O(n2)。</p><p>按数量级递增排列，常见的时间复杂度有：常数阶O(1),对数阶O(log2n),线性阶O(n), 线性对数阶O(nlog2n),平方阶O(n2)，立方阶O(n3),…， k次方阶O(nk),指数阶O(2n)。随着问题规模n的不断增大，上述时间复杂度不断增大，算法的执行效率越低。</p><p>前把时间复杂度的概念说了，是为了为下面的数据结构作铺垫。</p><h2 id="数据结构"><a href="#数据结构" class="headerlink" title="数据结构"></a>数据结构</h2><h3 id="Linked-List"><a href="#Linked-List" class="headerlink" title="Linked List"></a>Linked List</h3><ul><li>链表就是有节点<code>(Node)</code>组成的线性集合。每个指针都可以利用指针指向其他节点，它是一种包含多个节点，能够用于表示序列的数据结构。</li><li><strong>单向链表：</strong>链表中每个节点仅指向下个节点，并且最后一个节点指向null</li><li><strong>双向链表：</strong>链表中每个节点有两个指针x、y，x指向下个节点，y指向上个节点。最后一个节点y指向null</li><li>时间复杂度<ul><li>索引<code>O(n)</code></li><li>搜索<code>O(n)</code></li><li>插入<code>O(1)</code></li><li>移除<code>O(1)</code></li></ul></li></ul><h3 id="Stack"><a href="#Stack" class="headerlink" title="Stack"></a>Stack</h3><ul><li>栈是元素的集合，包括压栈<code>push</code>、移栈<code>pop</code>两个基本操作。</li><li>遵循后入先出的原则（LIFO）</li><li>时间复杂度<ul><li>索引<code>O(n)</code></li><li>搜索<code>O(n)</code></li><li>插入<code>O(1)</code></li><li>移除<code>O(1)</code></li></ul></li></ul><h3 id="Queue"><a href="#Queue" class="headerlink" title="Queue"></a>Queue</h3><ul><li>队列也是元素的集合，包括两个基本操作：<code>enqueue</code>将元素插入队列，<code>dequeue</code>将元素从队列中移除。</li><li>遵循先入先出的原则（FIFO），这里呢，可以这样理解 栈就像一个瓶子，队列呢 就像一根管子。</li><li>时间复杂度<ul><li>索引<code>O(n)</code></li><li>搜索<code>O(n)</code></li><li>插入<code>O(1)</code></li><li>移除<code>O(1)</code></li></ul></li></ul><h3 id="Tree"><a href="#Tree" class="headerlink" title="Tree"></a>Tree</h3><ul><li>树势无向，连同的无限图</li></ul><h3 id="Binary-Tree"><a href="#Binary-Tree" class="headerlink" title="Binary Tree"></a>Binary Tree</h3><ul><li>二叉树是每个节点最多包含左子节点和右子节点的树形数据结构</li><li><strong>满二叉树：</strong>树中每个节点最多包含0个或2个节点</li><li><strong>完全二叉树：</strong>除最后一层外，每一层上的结点数均达到最大值；在最后一层上只缺少右边的若干结点。</li></ul><h3 id="Binary-Search-Tree"><a href="#Binary-Search-Tree" class="headerlink" title="Binary Search Tree"></a>Binary Search Tree</h3><ul><li>二叉搜索树（BST）是一种特殊的二叉树，其任何节点中的值都会大于或者等于其左子树中存储的值并且小于或者等于其右子树中存储的值。</li><li>时间复杂度:<ul><li>索引: <code>O(log(n))</code></li><li>搜索: <code>O(log(n))</code></li><li>插入: <code>O(log(n))</code></li><li>删除: <code>O(log(n))</code></li></ul></li></ul><p><img src="http://www.bysocket.com/wp-content/uploads/2016/07/3.png" alt=""></p><h3 id="Trie"><a href="#Trie" class="headerlink" title="Trie"></a>Trie</h3><p>字典树它有3个基本性质：</p><ul><li>根节点不包含字符，除根节点外每一个节点都只包含一个字符。</li><li>从根节点到某一节点，路径上经过的字符连接起来，为该节点对应的字符串。</li><li>每个节点的所有子节点包含的字符都不相同</li></ul><p>即如果现在有b，abc，abd，bcd，abcd，efg，hii 这6个单词，我们可以构建一棵如下图所示的树：</p><p><img src="https://github.com/julycoding/The-Art-Of-Programming-By-July/raw/master/ebook/images/8/8.4/1.jpg" alt=""></p><p>未完待续。。。。。</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;作为一个经常在算法课上逃课的孩子，写这个有些尴尬，因为算法真的是太枯燥了，但是作为一个程序员，算法还是一定要会的（ps：许多大公司面试的时候特爱考）。在这里，简单说下几个基本的算法。&lt;/p&gt;
&lt;p&gt;在这之前，说下时间复杂度的概念。&lt;br&gt;
    
    </summary>
    
    
      <category term="Java" scheme="https://lennyup.github.io/tags/Java/"/>
    
  </entry>
  
  <entry>
    <title>初识rxjava（二）</title>
    <link href="https://lennyup.github.io/2017/03/16/rxjava-retrofit/"/>
    <id>https://lennyup.github.io/2017/03/16/rxjava-retrofit/</id>
    <published>2017-03-16T09:29:49.000Z</published>
    <updated>2017-10-11T06:15:16.000Z</updated>
    
    <content type="html"><![CDATA[<p>上一篇，简单的认识了最近火爆异常的RxJava,如果你对RxJava还是很陌生，你可以去网上找一下相关知识，当然也可以看我的上一篇文章<a href="https://lennyup.github.io/2017/03/14/rxjava-first/">初识RxJava</a>。这里我通过RxJava的使用场景之一——与Retrofit相结合，来具体看下RxJava的使用。</p><h2 id="基本"><a href="#基本" class="headerlink" title="基本"></a>基本</h2><p>RxJava和Retrofit结合使用的最基本的格式：<br><a id="more"></a><br>用<code>subscribeOn</code> 和<code>observeOn</code>来控制线程，并通过<code>subscribe()</code>来触发网络请求的开始。代码的大致形式：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="selector-tag">api</span><span class="selector-class">.getData</span>()</div><div class="line">   <span class="selector-class">.subscribeOn</span>(<span class="selector-tag">Schedulers</span><span class="selector-class">.io</span>())</div><div class="line">   <span class="selector-class">.observeOn</span>(<span class="selector-tag">AndroidSchedulers</span><span class="selector-class">.mainThread</span>())</div><div class="line">   <span class="selector-class">.subscribe</span>(<span class="selector-tag">observer</span>);</div></pre></td></tr></table></figure><p>具体的来看下我写的例子（ps： 一些布局什么的我就不往上贴了）</p><p>首先看我写的model，很简单，就一个描述和一个图片的地址</p><figure class="highlight haxe"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Images</span> </span>&#123;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">String</span> description;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">String</span> image_url;</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>接下来就是netWork。</p><figure class="highlight axapta"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NetWork</span> </span>&#123;</div><div class="line"> <span class="keyword">private</span> <span class="keyword">static</span> ElementaryApi elementaryApi;</div><div class="line">    ...</div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Converter.Factory gosnFactory = GsonConverterFactory.create();</div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> CallAdapter.Factory rxFactory = RxJavaCallAdapterFactory.create();</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> ElementaryApi getElementaryApi() &#123;</div><div class="line">        <span class="keyword">if</span> (elementaryApi == <span class="keyword">null</span>) &#123;</div><div class="line">            Retrofit retrofit = <span class="keyword">new</span> Retrofit.Builder()</div><div class="line">                    .<span class="keyword">client</span>(okHttpClient)</div><div class="line">                    .baseUrl(<span class="string">"http://www.zhuangbi.info/"</span>)</div><div class="line">                    .addConverterFactory(gosnFactory)</div><div class="line">                    .addCallAdapterFactory(rxFactory)</div><div class="line">                    .build();</div><div class="line">            elementaryApi = retrofit.create(ElementaryApi.class);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> elementaryApi;</div><div class="line">    &#125;</div><div class="line">    ...</div><div class="line">   &#125;</div></pre></td></tr></table></figure><p>这是<code>Retrofit</code>部分的代码，这里我用到的依赖包有这几个：</p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">compile</span> <span class="string">'io.reactivex:rxjava:1.2.7'</span></div><div class="line"><span class="keyword">compile</span> <span class="string">'io.reactivex:rxandroid:1.2.1'</span></div><div class="line"><span class="keyword">compile</span> <span class="string">'com.squareup.retrofit2:retrofit:2.2.0'</span></div><div class="line"><span class="keyword">compile</span> <span class="string">'com.squareup.retrofit2:converter-gson:2.2.0'</span></div><div class="line"><span class="keyword">compile</span> <span class="string">'com.squareup.retrofit2:adapter-rxjava:2.2.0'</span></div><div class="line"><span class="keyword">compile</span> <span class="string">'com.squareup.okhttp3:okhttp:3.6.0'</span></div></pre></td></tr></table></figure><p>关于<code>Retrofit</code>的相关用法，这里就不介绍了，有需要的可以自己去google下（ps: 在以后我会抽空写下关于<code>Retrofit2</code>的用法的），<br>可以看到这里有一个<code>ElementaryApi</code>,这就是<code>Retrofit</code>和<code>RxJava</code> 结合关键的地方了。其代码如下：</p><figure class="highlight less"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="selector-tag">public</span> <span class="selector-tag">interface</span> <span class="selector-tag">ElementaryApi</span> &#123;</div><div class="line">    <span class="variable">@GET</span>(<span class="string">"search"</span>)</div><div class="line">    Observable&lt;List&lt;Images&gt;&gt; search(<span class="variable">@Query</span>(<span class="string">"q"</span>) String query);</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>Retrofit 除了提供了传统的 <code>Callback</code> 形式的 API，还有 RxJava 版本的 <code>Observable</code> 形式 API。代码如上，在程序的构建过程中， Retrofit 会把自动把方法实现并生成代码，然后开发者就可以利用下面的方法来获取特定用户并处理响应。</p><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">...</div><div class="line">  <span class="meta">@Override</span></div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">success</span><span class="params">(User user)</span> </span>&#123;</div><div class="line">     ...    </div><div class="line">     &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">failure</span><span class="params">(RetrofitError <span class="keyword">error</span>)</span> </span>&#123;</div><div class="line">        <span class="comment">// Error handling</span></div><div class="line">        ...</div><div class="line">    &#125;</div></pre></td></tr></table></figure><p>因为返回的是<code>Observable</code>，所以其处理方式如下：</p><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">Observer&lt;List&lt;Images&gt;&gt; observer = <span class="keyword">new</span> Observer&lt;List&lt;Images&gt;&gt;() &#123;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">onCompleted</span><span class="params">()</span> </span>&#123;</div><div class="line"></div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">onError</span><span class="params">(Throwable e)</span> </span>&#123;</div><div class="line">        mLayout.setRefreshing(<span class="keyword">false</span>);</div><div class="line">        Toast.makeText(getActivity(), <span class="string">"失败"</span>, Toast.LENGTH_SHORT).show();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">onNext</span><span class="params">(List&lt;Images&gt; images)</span> </span>&#123;</div><div class="line">        mLayout.setRefreshing(<span class="keyword">false</span>);</div><div class="line">        adapter.setImages(images);</div><div class="line">    &#125;</div><div class="line">&#125;;</div><div class="line">...</div><div class="line"><span class="keyword">private</span>  <span class="function"><span class="keyword">void</span> <span class="title">search</span><span class="params">(String key)</span> </span>&#123;</div><div class="line">Subscription mSubscription = NetWork.getElementaryApi()</div><div class="line">            .search(key)</div><div class="line">            .subscribeOn(Schedulers.io())</div><div class="line">            .observeOn(AndroidSchedulers.mainThread())</div><div class="line">            .subscribe(observer);</div><div class="line">&#125;</div><div class="line">...</div></pre></td></tr></table></figure><p>到这里，是不是很熟悉了，<code>RxJava</code>的用法。附上我测试的效果。</p><p><img src="https://raw.githubusercontent.com/lennyup/img-warehouse/master/rxjava-retrofit1.png" alt=""></p><h2 id="转换（map）"><a href="#转换（map）" class="headerlink" title="转换（map）"></a>转换（map）</h2><p>有些接口的设计，会在我们需要的数据外包一层，添加点额外的信息，这些信息本地显示是用不到的，这个时候，我们就要用到<code>map()</code>把我们需要的信息剥离出来。代码的大致形式如下：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="selector-tag">api</span><span class="selector-class">.getData</span>()</div><div class="line">   <span class="selector-class">.map</span>(<span class="selector-tag">response</span> <span class="selector-tag">-</span>&gt; <span class="selector-tag">response</span><span class="selector-class">.data</span>)</div><div class="line">   <span class="selector-class">.subscribeOn</span>(<span class="selector-tag">Schedulers</span><span class="selector-class">.io</span>())</div><div class="line">   <span class="selector-class">.observeOn</span>(<span class="selector-tag">AndroidSchedulers</span><span class="selector-class">.mainThread</span>())</div><div class="line">   <span class="selector-class">.subscribe</span>(<span class="selector-tag">observer</span>);</div></pre></td></tr></table></figure><p>我这里所做的例子是把网络上请求回来的时间格式转换成 <code>yy/MM/dd HH:mm:ss</code>的形式。<br>先看一下model</p><figure class="highlight haxe"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GankBeauty</span> </span>&#123;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">String</span> createdAt;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">String</span> url;</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>一个是<code>url</code>是显示图片所需要的地址，<code>createAt</code>就是我转换要用到的时间。由于我获取的是一个list，所以我们要把这个再包一下：</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GankBeautyResult</span> </span>&#123;</div><div class="line">    <span class="comment">//public boolean error;</span></div><div class="line">    <span class="keyword">public</span> <span class="meta">@SerializedName(<span class="meta-string">"results"</span>)</span></div><div class="line">    List&lt;GankBeauty&gt; beauties;</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>接下来就要写我们要<code>retrofit</code>返回给我们的<code>Observable</code>了</p><figure class="highlight less"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="selector-tag">public</span> <span class="selector-tag">interface</span> <span class="selector-tag">MapApi</span> &#123;</div><div class="line">    <span class="variable">@GET</span>(<span class="string">"data/福利/&#123;number&#125;/&#123;page&#125;"</span>)</div><div class="line">    Observable&lt;GankBeautyResult&gt; getBeauties(<span class="variable">@Path</span>(<span class="string">"number"</span>) int number, <span class="variable">@Path</span>(<span class="string">"page"</span>) int page);</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>网络请求代码：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">...</div><div class="line"><span class="keyword">private</span> <span class="keyword">static</span> MapApi mapApi;</div><div class="line">...</div><div class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> MapApi <span class="title">getMapApi</span><span class="params">()</span> </span>&#123;</div><div class="line">       <span class="keyword">if</span> (mapApi ==null) &#123;</div><div class="line">           Retrofit retrofit = <span class="keyword">new</span> Retrofit.Builder()</div><div class="line">                   .client(okHttpClient)</div><div class="line">                   .baseUrl(<span class="string">"http://gank.io/api/"</span>)</div><div class="line">                   .addConverterFactory(gosnFactory)</div><div class="line">                   .addCallAdapterFactory(rxFactory)</div><div class="line">                   .build();</div><div class="line">           mapApi = retrofit.create(MapApi.<span class="keyword">class</span>);</div><div class="line">       &#125;</div><div class="line">       <span class="keyword">return</span> mapApi;</div><div class="line">   &#125;</div></pre></td></tr></table></figure><p><code>RxJava</code>创建订阅：</p><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">mSubscription = NetWork.getMapApi()</div><div class="line"><span class="meta">               .getBeauties</span>(<span class="number">10</span>, page)</div><div class="line"><span class="meta">               .map</span>(GankBeautyResultToItemsMapper.getInstance())</div><div class="line"><span class="meta">               .subscribeOn</span>(Schedulers.io())</div><div class="line"><span class="meta">               .observeOn</span>(AndroidSchedulers.mainThread())</div><div class="line"><span class="meta">               .subscribe</span>(observer)<span class="comment">;</span></div></pre></td></tr></table></figure><p>我把<code>map()</code>里的方法<code>Fun1</code>抽成了一个单独的类，来看下：</p><figure class="highlight haxe"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GankBeautyResultToItemsMapper</span> <span class="keyword"><span class="keyword">implements</span> <span class="type">Func1</span></span>&lt;<span class="title">GankBeautyResult</span>, <span class="title">List</span>&lt;<span class="title">MapItem</span>&gt;&gt;</span>&#123;</div><div class="line"></div><div class="line">...</div><div class="line">    @Override</div><div class="line">    <span class="keyword">public</span> List&lt;MapItem&gt; call(GankBeautyResult gankBeautyResult) &#123;</div><div class="line">        List&lt;GankBeauty&gt; gankBeauties = gankBeautyResult.beauties;</div><div class="line">        List&lt;MapItem&gt; items = <span class="keyword">new</span> <span class="type">ArrayList</span>&lt;&gt;(gankBeauties.size());</div><div class="line">        SimpleDateFormat inputFormat = <span class="keyword">new</span> <span class="type">SimpleDateFormat</span>(<span class="string">"yyyy-MM-dd'T'HH:mm:ss.SS'Z'"</span>);</div><div class="line">        SimpleDateFormat outputFormat = <span class="keyword">new</span> <span class="type">SimpleDateFormat</span>(<span class="string">"yy/MM/dd HH:mm:ss"</span>);</div><div class="line">        <span class="keyword">for</span> (GankBeauty gankBeauty : <span class="type">gankBeauties</span>) &#123;</div><div class="line">            MapItem item = <span class="keyword">new</span> <span class="type">MapItem</span>();</div><div class="line">            <span class="keyword">try</span> &#123;</div><div class="line">                Date date = inputFormat.parse(gankBeauty.createdAt);</div><div class="line">                item.description = outputFormat.format(date);</div><div class="line"></div><div class="line">            &#125; <span class="keyword">catch</span> (ParseException e) &#123;</div><div class="line">                e.printStackTrace();</div><div class="line">                item.description = <span class="string">"unknown date"</span>;</div><div class="line">            &#125;</div><div class="line">            item.imageUrl = gankBeauty.url;</div><div class="line">            items.add(item);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> items;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>效果如下：</p><p><img src="https://raw.githubusercontent.com/lennyup/img-warehouse/master/rxjava-retrofit2.png" alt=""></p><p>当然，<code>map</code>也可以用于其他需求的格式转换。</p><h2 id="压合（zip）"><a href="#压合（zip）" class="headerlink" title="压合（zip）"></a>压合（zip）</h2><p>有的时候，需要同时访问不同的接口，然后将结果做下处理，返回统一的格式。比如我们经常会看到一个list列表里就有广告，这种并行的异步请求比较麻烦，但是用<code>zip</code>之后就会简单好多。代码大致形式如下：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="selector-tag">Observable</span><span class="selector-class">.zip</span>(<span class="selector-tag">api</span><span class="selector-class">.getData</span>(), <span class="selector-tag">adApi</span><span class="selector-class">.getAds</span>(), <span class="selector-tag">zipFunc</span>())</div><div class="line">  <span class="selector-class">.subscribeOn</span>(<span class="selector-tag">Schedulers</span><span class="selector-class">.io</span>())</div><div class="line">  <span class="selector-class">.observeOn</span>(<span class="selector-tag">AndroidSchedulers</span><span class="selector-class">.mainThread</span>())</div><div class="line">  <span class="selector-class">.subscribe</span>(<span class="selector-tag">observer</span>)；</div></pre></td></tr></table></figure><p>我们来直接看详细的代码：</p><figure class="highlight processing"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">...</div><div class="line">mSubscription = Observable.zip(NetWork.getMapApi().getBeauties(<span class="number">100</span>, <span class="number">1</span>).<span class="built_in">map</span>(GankBeautyResultToItemsMapper.getInstance()),</div><div class="line">                NetWork.getElementaryApi().search(<span class="string">"可爱"</span>),</div><div class="line">                <span class="keyword">new</span> Func2&lt;List&lt;MapItem&gt;, List&lt;Images&gt;, List&lt;MapItem&gt;&gt;() &#123;</div><div class="line">                    @Override</div><div class="line">                    <span class="keyword">public</span> List&lt;MapItem&gt; call(List&lt;MapItem&gt; mapItems, List&lt;Images&gt; images) &#123;</div><div class="line">                        List&lt;MapItem&gt; items = <span class="keyword">new</span> ArrayList&lt;MapItem&gt;();</div><div class="line">                        <span class="keyword">for</span> (<span class="built_in">int</span> i =<span class="number">0</span>;i &lt; mapItems.<span class="built_in">size</span>() /<span class="number">2</span> &amp;&amp; i &lt; images.<span class="built_in">size</span>(); i ++) &#123;</div><div class="line">                            items.<span class="built_in">add</span>(mapItems.<span class="built_in">get</span>(i * <span class="number">2</span>));</div><div class="line">                            items.<span class="built_in">add</span>(mapItems.<span class="built_in">get</span>(i * <span class="number">2</span> + <span class="number">1</span>));</div><div class="line">                            MapItem item = <span class="keyword">new</span> MapItem();</div><div class="line">                            Images <span class="built_in">image</span> = images.<span class="built_in">get</span>(i);</div><div class="line">                            item.description = <span class="built_in">image</span>.description;</div><div class="line">                            item.imageUrl = <span class="built_in">image</span>.image_url;</div><div class="line">                            items.<span class="built_in">add</span>(item);</div><div class="line">                        &#125;</div><div class="line">                        <span class="keyword">return</span> items;</div><div class="line">                    &#125;</div><div class="line">                &#125;)</div><div class="line">                .subscribeOn(Schedulers.io())</div><div class="line">                .observeOn(AndroidSchedulers.mainThread())</div><div class="line">                .subscribe(observer);</div><div class="line">                ...</div></pre></td></tr></table></figure><p>这段代码很容易理解，我就不过多解释了。</p><h2 id="token"><a href="#token" class="headerlink" title="token"></a>token</h2><p>处于安全性，性能等多方面的考虑，大多数服务器会有一些接口需要传入token才能正确的返回数据，但是请求token的是另一个接口，所以需要两步连续的请求才能请求到数据。使用<code>flatMap</code>可以用较清晰的代码实现连续请求，避免callback嵌套的结构，代码大致如下：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="selector-tag">api</span><span class="selector-class">.getToken</span>()</div><div class="line">   <span class="selector-class">.flatMap</span>(<span class="selector-tag">token</span> <span class="selector-tag">-</span>&gt; <span class="selector-tag">api</span><span class="selector-class">.getData</span>(<span class="selector-tag">token</span>))</div><div class="line">   <span class="selector-class">.subscribeOn</span>(<span class="selector-tag">Schedukers</span><span class="selector-class">.io</span>())</div><div class="line">   <span class="selector-class">.observeOn</span>(<span class="selector-tag">AndroidSchedulers</span><span class="selector-class">.mainThread</span>())</div><div class="line">   <span class="selector-class">.subscribe</span>(<span class="selector-tag">observer</span>);</div></pre></td></tr></table></figure><p>这里我是伪造的token，所以需要个model。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FakeToken</span> </span>&#123;</div><div class="line">    <span class="keyword">public</span> String token;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">boolean</span> expired;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">FakeToken</span><span class="params">(<span class="keyword">boolean</span> expired)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.expired = expired;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">FakeToken</span><span class="params">()</span> </span>&#123;</div><div class="line"></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>还需要一个有<code>id</code>和<code>name</code>的model</p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">class</span> FakeThing &#123;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">int</span> id;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">String</span> name;</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>把传入的string字符串，返回一个faketoken对象，在由一个<code>faketoken</code>对象返回我们需要的id和name，完成连续两步请求。</p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">class</span> FakeApi &#123;</div><div class="line">    Random <span class="built_in">random</span> = <span class="keyword">new</span> Random();</div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">String</span> createToken() &#123;</div><div class="line">        <span class="built_in">return</span> <span class="string">"fake_token_"</span> + System.currentTimeMillis() % <span class="number">10000</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">public</span> Observable&lt;FakeToken&gt; getFakeToken(@NonNull final <span class="keyword">String</span> fakeAuth) &#123;</div><div class="line">        <span class="built_in">return</span> Observable.just(fakeAuth)</div><div class="line">                .<span class="built_in">map</span>(<span class="keyword">new</span> Func1&lt;<span class="keyword">String</span>, FakeToken&gt;() &#123;</div><div class="line">                    @Override</div><div class="line">                    <span class="keyword">public</span> FakeToken call(<span class="keyword">String</span> s) &#123;</div><div class="line">                        <span class="keyword">int</span> fakeNetworkTime = <span class="built_in">random</span>.nextInt(<span class="number">500</span>) + <span class="number">500</span>;</div><div class="line">                        <span class="built_in">try</span> &#123;</div><div class="line">                            Thread.sleep(fakeNetworkTime);</div><div class="line">                        &#125; <span class="built_in">catch</span> (InterruptedException e) &#123;</div><div class="line">                            e.printStackTrace();</div><div class="line">                        &#125;</div><div class="line">                        FakeToken fakeToken = <span class="keyword">new</span> FakeToken();</div><div class="line">                        fakeToken.token = createToken();</div><div class="line">                        <span class="built_in">return</span> fakeToken;</div><div class="line">                    &#125;</div><div class="line">                &#125;);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> Observable&lt;FakeThing&gt; getFakeData(FakeToken fakeToken) &#123;</div><div class="line">        <span class="built_in">return</span> Observable.just(fakeToken)</div><div class="line">                .<span class="built_in">map</span>(<span class="keyword">new</span> Func1&lt;FakeToken, FakeThing&gt;() &#123;</div><div class="line">                    @Override</div><div class="line">                    <span class="keyword">public</span> FakeThing call(FakeToken fakeToken) &#123;</div><div class="line">                        <span class="comment">// Add some random delay to mock the network delay</span></div><div class="line">                        <span class="keyword">int</span> fakeNetworkTimeCost = <span class="built_in">random</span>.nextInt(<span class="number">500</span>) + <span class="number">500</span>;</div><div class="line">                        <span class="built_in">try</span> &#123;</div><div class="line">                            Thread.sleep(fakeNetworkTimeCost);</div><div class="line">                        &#125; <span class="built_in">catch</span> (InterruptedException e) &#123;</div><div class="line">                            e.printStackTrace();</div><div class="line">                        &#125;</div><div class="line"></div><div class="line">                        <span class="built_in">if</span> (fakeToken.expired) &#123;</div><div class="line">                            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"Token expired!"</span>);</div><div class="line">                        &#125;</div><div class="line"></div><div class="line">                        FakeThing fakeData = <span class="keyword">new</span> FakeThing();</div><div class="line">                        fakeData.id = (<span class="keyword">int</span>) (System.currentTimeMillis() % <span class="number">1000</span>);</div><div class="line">                        fakeData.name = <span class="string">"FAKE_USER_"</span> + fakeData.id;</div><div class="line">                        <span class="built_in">return</span> fakeData;</div><div class="line">                    &#125;</div><div class="line">                &#125;);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure><p>创建订阅</p><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">mSubscription = fakeApi.getFakeToken(<span class="string">"fake_auth_code"</span>)</div><div class="line">                .flatMap(<span class="keyword">new</span> Func1&lt;FakeToken, Observable&lt;FakeThing&gt;&gt;() &#123;</div><div class="line">                    <span class="meta">@Override</span></div><div class="line">                    <span class="keyword">public</span> Observable&lt;FakeThing&gt; call(FakeToken fakeToken) &#123;</div><div class="line"></div><div class="line">                        <span class="function"><span class="keyword">return</span> fakeApi.<span class="title">getFakeData</span><span class="params">(fakeToken)</span></span>;</div><div class="line">                    &#125;</div><div class="line">                &#125;)</div><div class="line">                .subscribeOn(Schedulers.io())</div><div class="line">                .observeOn(AndroidSchedulers.mainThread())</div><div class="line">                .subscribe(<span class="keyword">new</span> Action1&lt;FakeThing&gt;() &#123;</div><div class="line">                    <span class="meta">@Override</span></div><div class="line">                    <span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">call</span><span class="params">(FakeThing fakeThing)</span> </span>&#123;</div><div class="line">                        ...</div><div class="line">                    &#125;</div><div class="line">                &#125;, <span class="keyword">new</span> Action1&lt;Throwable&gt;() &#123;</div><div class="line">                    <span class="meta">@Override</span></div><div class="line">                    <span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">call</span><span class="params">(Throwable throwable)</span> </span>&#123;</div><div class="line">                        ...</div><div class="line">                    &#125;</div><div class="line">                &#125;);</div></pre></td></tr></table></figure><h2 id="高级token"><a href="#高级token" class="headerlink" title="高级token"></a>高级token</h2><p>很多情况下，token是一整不变的，知道它超时或者被销毁（多数token都是这样的）。这样的token，需要把它保存起来，并且在发现它失效的时候要能够自动重新获取新的token并继续访问之前由于token失效而失败的请求。这种情况，以前需要很多复杂的代码，要是用RxJava，可以用<code>retryWhen()</code>来轻松来处理这种情况。大致代码形式如下：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="selector-tag">api</span><span class="selector-class">.getData</span>(<span class="selector-tag">token</span>)</div><div class="line">   <span class="selector-class">.retryWhen</span>(<span class="selector-tag">observable</span> <span class="selector-tag">-</span>&gt;</div><div class="line">    <span class="selector-tag">observable</span><span class="selector-class">.flatMap</span>( <span class="selector-tag">-</span>&gt;</div><div class="line">    <span class="selector-tag">api</span><span class="selector-class">.getToken</span>()</div><div class="line">    <span class="selector-class">.doOnNext</span>(<span class="selector-tag">-</span>&gt;<span class="selector-tag">updateToken</span>())))</div><div class="line">   <span class="selector-class">.subscribeOn</span>(<span class="selector-tag">Schedulers</span><span class="selector-class">.io</span>())</div><div class="line">   <span class="selector-class">.observeOn</span>(<span class="selector-tag">AndroidSchedlers</span><span class="selector-class">.mainThread</span>())</div><div class="line">   <span class="selector-class">.subscribe</span>(<span class="selector-tag">observer</span>)</div></pre></td></tr></table></figure><p>详细代码如下：</p><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">final</span> FakeToken cachedFakeToken = <span class="keyword">new</span> FakeToken(<span class="keyword">true</span>);</div><div class="line">      mSubscription = Observable.just(<span class="keyword">null</span>)</div><div class="line">                .flatMap(<span class="keyword">new</span> Func1&lt;Object, Observable&lt;FakeThing&gt;&gt;() &#123;</div><div class="line">                    <span class="meta">@Override</span></div><div class="line">                    <span class="keyword">public</span> Observable&lt;FakeThing&gt; call(Object o) &#123;</div><div class="line">                        <span class="keyword">return</span> cachedFakeToken.token == <span class="keyword">null</span></div><div class="line">                                ? Observable.&lt;FakeThing&gt;<span class="keyword">error</span>(<span class="keyword">new</span> NullPointerException(<span class="string">"Token is null!"</span>))</div><div class="line">                                : fakeApi.getFakeData(cachedFakeToken);</div><div class="line">                    &#125;</div><div class="line">                &#125;)</div><div class="line">                .retryWhen(<span class="keyword">new</span> Func1&lt;Observable&lt;? <span class="keyword">extends</span> Throwable&gt;, Observable&lt;?&gt;&gt;() &#123;</div><div class="line">                    <span class="meta">@Override</span></div><div class="line">                    <span class="keyword">public</span> Observable&lt;?&gt; call(Observable&lt;? <span class="keyword">extends</span> Throwable&gt; observable) &#123;</div><div class="line">                        <span class="function"><span class="keyword">return</span> observable.<span class="title">flatMap</span><span class="params">(<span class="keyword">new</span> Func1&lt;Throwable, Observable&lt;?&gt;&gt;()</span> </span>&#123;</div><div class="line">                            <span class="meta">@Override</span></div><div class="line">                            <span class="keyword">public</span> Observable&lt;?&gt; call(Throwable throwable) &#123;</div><div class="line">                                <span class="keyword">if</span> (throwable <span class="keyword">instanceof</span> IllegalArgumentException || throwable <span class="keyword">instanceof</span> NullPointerException) &#123;</div><div class="line">                                    <span class="keyword">return</span> fakeApi.getFakeToken(<span class="string">"fake_auth_code"</span>)</div><div class="line">                                            .doOnNext(<span class="keyword">new</span> Action1&lt;FakeToken&gt;() &#123;</div><div class="line">                                                <span class="meta">@Override</span></div><div class="line">                                                <span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">call</span><span class="params">(FakeToken fakeToken)</span> </span>&#123;</div><div class="line">                                                    tokenUpdated = <span class="keyword">true</span>;</div><div class="line">                                                    cachedFakeToken.token = fakeToken.token;</div><div class="line">                                                    cachedFakeToken.expired = fakeToken.expired;</div><div class="line">                                                &#125;</div><div class="line">                                            &#125;);</div><div class="line">                                &#125;</div><div class="line">                                <span class="function"><span class="keyword">return</span> Observable.<span class="title">error</span><span class="params">(throwable)</span></span>;</div><div class="line">                            &#125;</div><div class="line">                        &#125;);</div><div class="line">                    &#125;</div><div class="line">                &#125;)</div><div class="line">                .subscribeOn(Schedulers.io())</div><div class="line">                .observeOn(AndroidSchedulers.mainThread())</div><div class="line">                .subscribe(<span class="keyword">new</span> Action1&lt;FakeThing&gt;() &#123;</div><div class="line">                    <span class="meta">@Override</span></div><div class="line">                    <span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">call</span><span class="params">(FakeThing fakeData)</span> </span>&#123;</div><div class="line">                        swipeRefreshLayout.setRefreshing(<span class="keyword">false</span>);</div><div class="line">                        String token = cachedFakeToken.token;</div><div class="line">                        <span class="keyword">if</span> (tokenUpdated) &#123;</div><div class="line">                            token += <span class="string">"("</span> + getString(R.string.updated) + <span class="string">")"</span>;</div><div class="line">                        &#125;</div><div class="line">                        tokenTv.setText(getString(R.string.got_token_and_data, token, fakeData.id, fakeData.name));</div><div class="line">                    &#125;</div><div class="line">                &#125;, <span class="keyword">new</span> Action1&lt;Throwable&gt;() &#123;</div><div class="line">                    <span class="meta">@Override</span></div><div class="line">                    <span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">call</span><span class="params">(Throwable throwable)</span> </span>&#123;</div><div class="line">                        swipeRefreshLayout.setRefreshing(<span class="keyword">false</span>);</div><div class="line">                        Toast.makeText(getActivity(), <span class="string">"失败"</span>, Toast.LENGTH_SHORT).show();</div><div class="line">                    &#125;</div><div class="line">                &#125;);</div></pre></td></tr></table></figure><h2 id="缓存"><a href="#缓存" class="headerlink" title="缓存"></a>缓存</h2><p>RxJava中有一个类叫做<code>SubJect</code>,它既是<code>Obserevable</code>又是<code>Observer</code>,可以用做中间件来传递数据。例如，用它的子类<code>BehaviorSubject</code>来缓存数据。大致代码如下：</p><figure class="highlight gcode"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">api.getData<span class="comment">()</span></div><div class="line">   .subscribe<span class="comment">(behavioSubject)</span>;<span class="comment">//缓存数据</span></div><div class="line">   behaviorSubject.subscribe<span class="comment">(observer)</span> <span class="comment">//把缓存数据发送给observer</span></div></pre></td></tr></table></figure><p>如有任何问题请联系我微博<a href="http://weibo.com/3652601464/profile?rightmod=1&amp;wvr=6&amp;mod=personinfo&amp;is_all=1" target="_blank" rel="external">空白_Lester</a></p><p>本文地址 <a href="https://lennyup.github.io/2017/03/16/rxjava-retrofit/">https://lennyup.github.io/2017/03/16/rxjava-retrofit</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;上一篇，简单的认识了最近火爆异常的RxJava,如果你对RxJava还是很陌生，你可以去网上找一下相关知识，当然也可以看我的上一篇文章&lt;a href=&quot;https://lennyup.github.io/2017/03/14/rxjava-first/&quot;&gt;初识RxJava&lt;/a&gt;。这里我通过RxJava的使用场景之一——与Retrofit相结合，来具体看下RxJava的使用。&lt;/p&gt;
&lt;h2 id=&quot;基本&quot;&gt;&lt;a href=&quot;#基本&quot; class=&quot;headerlink&quot; title=&quot;基本&quot;&gt;&lt;/a&gt;基本&lt;/h2&gt;&lt;p&gt;RxJava和Retrofit结合使用的最基本的格式：&lt;br&gt;
    
    </summary>
    
    
      <category term="Android" scheme="https://lennyup.github.io/tags/Android/"/>
    
  </entry>
  
  <entry>
    <title>初识RxJava</title>
    <link href="https://lennyup.github.io/2017/03/14/rxjava-first/"/>
    <id>https://lennyup.github.io/2017/03/14/rxjava-first/</id>
    <published>2017-03-14T07:23:15.000Z</published>
    <updated>2017-10-11T06:15:11.000Z</updated>
    
    <content type="html"><![CDATA[<p>自打进入公司以来，一直用的是React Native，以及 React + WebView的结构来写代码，对原生的一些知识学习落后了许多。老是听朋友说什么 RxJava，一脸懵逼。现在，趁闲暇之时，补充下Android知识，在这里简单说下对RxJava的理解。</p><p>在开始之前呢，先要说下其github以及要依赖的包，由于现在 RxJava2已经有了一段时间了，但是对于小白的我来说，还是先从1开始吧。</p><p>GitHub:</p><p><a href="https://github.com/ReactiveX/RxJava" target="_blank" rel="external">https://github.com/ReactiveX/RxJava</a><br><a href="https://github.com/ReactiveX/RxAndroid" target="_blank" rel="external">https://github.com/ReactiveX/RxAndroid</a><br><a id="more"></a><br>引入的依赖：</p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">compile</span> <span class="string">'io.reactivex:rxjava:1.2.7'</span></div><div class="line"><span class="keyword">compile</span> <span class="string">'io.reactivex:rxandroid:1.2.1'</span></div></pre></td></tr></table></figure><h2 id="RxJava是什么"><a href="#RxJava是什么" class="headerlink" title="RxJava是什么"></a>RxJava是什么</h2><p>相信所有初学者应该和我一样，对于这个很陌生，我们看下github上对其介绍：<code>RxJava – Reactive Extensions for the JVM – a library for composing asynchronous and event-based programs using observable sequences for the Java VM.</code><br>(大概意思是说 这是一个在VM上使用可观察的序列来组成异步、基于事件的库)</p><p>这里我们就可以总结的说 RxJava是一个实现异步操作的类。异步实现 ？那我们之前也写过很多呀 像 AsyncTask / Handler / XXX / …<br>那为什么现在大家都在用 RxJava呢 ？带着疑问我们来简单说下它的一些用法。</p><h2 id="API介绍"><a href="#API介绍" class="headerlink" title="API介绍"></a>API介绍</h2><p>首先，RxJava的异步实现是通过观察者模式实现的。</p><h3 id="观察者模式"><a href="#观察者模式" class="headerlink" title="观察者模式"></a>观察者模式</h3><p>观察者模式是这样的：A 对象（观察者）对 B 对象（被观察者）的某种变化高度敏感，需要在 B 变化的一瞬间做出反应。举个开发中的例子就是点击监听器<code>OnClickListener</code>,程序中的观察者是采用注册(Register)或者是订阅(Subscribe)的关系来告诉被观察者的。<br>OnClickListener的模式大致如图：<br><img src="http://ww4.sinaimg.cn/mw1024/52eb2279jw1f2rx42h1wgj20fz03rglt.jpg" alt=""><br>当<code>Button</code>被点击之后，会通过<code>setOnClickListener</code>方法中的<code>OnClick</code>来通知器点击状态的。<br>那么转换成观察者模式就是这样<br><img src="http://ww3.sinaimg.cn/mw1024/52eb2279jw1f2rx4446ldj20ga03p74h.jpg" alt=""></p><h3 id="RxJava的观察者模式"><a href="#RxJava的观察者模式" class="headerlink" title="RxJava的观察者模式"></a>RxJava的观察者模式</h3><p>RxJava有这几个概念：<code>Observable</code>(被观察者)、<code>Observer</code>(观察者)、<code>subscribe</code>订阅、事件。<code>Observer</code>和<code>Observable</code>通过<code>subscribe</code>来实现订阅关系。<code>Observable</code>需要的时候通过<code>subscribe</code>来通知<code>Observer</code>。</p><p>RxJava的回调事件有三个：</p><ul><li><code>onNext</code>: 相当于<code>OnClickListener</code>中的<code>OnClick</code>;</li><li><code>onError</code>:事件队列异常。与下面的<code>onCompleted</code>互斥。</li><li><code>onCompleted</code>：事件队列完成。当不会再有<code>onNext</code>发出时，会触发<code>onCompleted</code></li></ul><p>###基本实现<br>(1) Observer</p><p>观察者，决定触发时执行的动作。实现方式：</p><figure class="highlight lasso"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">Observer&lt;<span class="built_in">String</span>&gt; observer = <span class="literal">new</span> Observer&lt;<span class="built_in">String</span>&gt;() &#123;</div><div class="line">            @Override</div><div class="line">            <span class="keyword">public</span> <span class="literal">void</span> onCompleted() &#123;</div><div class="line">                <span class="keyword">Log</span>.w(<span class="built_in">TAG</span>, <span class="string">"Observer onCompleted"</span>);</div><div class="line">            &#125;</div><div class="line"></div><div class="line">            @Override</div><div class="line">            <span class="keyword">public</span> <span class="literal">void</span> onError(Throwable e) &#123;</div><div class="line">                <span class="keyword">Log</span>.w(<span class="built_in">TAG</span>, <span class="string">"Observer onError"</span>);</div><div class="line">            &#125;</div><div class="line"></div><div class="line">            @Override</div><div class="line">            <span class="keyword">public</span> <span class="literal">void</span> onNext(<span class="built_in">String</span> s) &#123;</div><div class="line">                <span class="keyword">Log</span>.w(<span class="built_in">TAG</span>, <span class="string">"Item "</span> + s);</div><div class="line">            &#125;</div><div class="line">        &#125;;</div></pre></td></tr></table></figure><p>此外，还有一种Observer的实现方式 <code>Subscriber</code>,它是observer的一个扩展抽象类。</p><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">Subscriber&lt;String&gt; subscriber = <span class="keyword">new</span> Subscriber&lt;String&gt;() &#123;</div><div class="line">            <span class="meta">@Override</span></div><div class="line">            <span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">onCompleted</span><span class="params">()</span> </span>&#123;</div><div class="line"></div><div class="line">            &#125;</div><div class="line"></div><div class="line">            <span class="meta">@Override</span></div><div class="line">            <span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">onError</span><span class="params">(Throwable e)</span> </span>&#123;</div><div class="line"></div><div class="line">            &#125;</div><div class="line"></div><div class="line">            <span class="meta">@Override</span></div><div class="line">            <span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">onNext</span><span class="params">(String s)</span> </span>&#123;</div><div class="line"></div><div class="line">            &#125;</div><div class="line"></div><div class="line">            <span class="meta">@Override</span></div><div class="line">            <span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">onStart</span><span class="params">()</span> </span>&#123;</div><div class="line">                <span class="keyword">super</span>.onStart();</div><div class="line">            &#125;</div><div class="line"></div><div class="line">        &#125;;</div></pre></td></tr></table></figure><p><code>subscriber</code>比<code>observer</code>多几个方法。这里只说其中的两个：</p><ul><li><code>onStart()</code>它会在 subscribe 刚开始，而事件还未发送之前被调用，可以用于做一些准备工作，例如数据的清零或重置。如果所要做的操作对于线程有要求，那么这个方法就不适合了。</li><li><code>unsubscribe()</code>用于取消订阅，可以通过<code>isUnsubscribed()</code>来判断下状态。</li></ul><p>(2) Observable</p><p>被观察者，决定什么时候触发以及触发什么事件。</p><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">Observable observable = Observable.create(new Observable.OnSubscribe&lt;String&gt;()&#123;</div><div class="line"></div><div class="line">            @Override</div><div class="line">            public void call(<span class="keyword">Subscriber&lt;? </span>super String&gt; <span class="keyword">subscriber) </span>&#123;</div><div class="line">                observer.onNext(<span class="string">"Hi"</span>)<span class="comment">;</span></div><div class="line">                observer.onNext(<span class="string">"who are you"</span>)<span class="comment">;</span></div><div class="line">                observer.onNext(<span class="string">"I am Li"</span>)<span class="comment">;</span></div><div class="line">                observer.onCompleted()<span class="comment">;</span></div><div class="line">            &#125;</div><div class="line">        &#125;)<span class="comment">;</span></div></pre></td></tr></table></figure><p>(ps: 现在这种方式已经被废弃了)</p><p>还有另几种创建方法：</p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="attribute">Observable observable</span> = Observable.just(<span class="string">"Hi"</span>, <span class="string">"Who are you"</span>, <span class="string">"I am Li"</span>);</div></pre></td></tr></table></figure><figure class="highlight golo"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">String [] s = &#123;<span class="string">"Hi"</span>, <span class="string">"who are you"</span>, <span class="string">"I am Li"</span>&#125;;</div><div class="line"><span class="keyword">Observable</span> observable1 = <span class="keyword">Observable</span>.from(s);</div></pre></td></tr></table></figure><p>(3) Subscribe (订阅)<br>将<code>Observable</code>和<code>Observer</code>关联起来</p><figure class="highlight abnf"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">observable.subscribe(observer)<span class="comment">;</span></div></pre></td></tr></table></figure><h3 id="线程控制"><a href="#线程控制" class="headerlink" title="线程控制"></a>线程控制</h3><p>你会了上边的那些步骤，并不代表你已经入门了，以为RxJavaz最主要的概念是<code>异步</code>,这样就引出了我们要说的线程控制——Scheduler，比如说我们加载图片，然后显示在屏幕上。这就需要Scheduler了。</p><h4 id="Scheduler的API"><a href="#Scheduler的API" class="headerlink" title="Scheduler的API"></a>Scheduler的API</h4><p>在不指定线程的情况下，RxJava是不会改变线程的。在RxJava中， Scheduler相当于线程控制器，用来指定每段代码多运行在什么样的线程上。来看下它适合哪些场景：</p><ul><li><code>Schedulers.immediate()</code>: 默认的，直接运行在当前线程。</li><li><code>Schedulers.newThread()</code>: 新线程。</li><li><code>Schedulers.io()</code>: I/O线程（读写文件、读写数据库、网络信息交互）</li><li><code>Schedulers.computation()</code>：CPU密集型计算所使用的线程。</li><li><code>AndroidSchedulers.mainThread()</code>: 主线程。</li></ul><p>对线程控制的话，通过<code>subscribeOn()</code>和<code>observeOn()</code>这两个方法</p><ul><li><code>subscribeOn</code>: 指定<code>subscribe</code>所发生的线程。即事件发生的线程。</li><li><code>observeOn</code>：事件消费线程，<code>Subscriber</code>所运行在的线程。</li></ul><figure class="highlight lasso"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">Observable.just(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>)</div><div class="line">                .<span class="built_in">map</span>(<span class="literal">new</span> Func1&lt;<span class="built_in">Integer</span>, <span class="built_in">String</span>&gt;() &#123;</div><div class="line">                    @Override</div><div class="line">                    <span class="keyword">public</span> <span class="built_in">String</span> call(<span class="built_in">Integer</span> <span class="built_in">integer</span>) &#123;</div><div class="line">                        <span class="keyword">return</span> <span class="string">""</span> + <span class="built_in">integer</span>;</div><div class="line">                    &#125;</div><div class="line">                &#125;)</div><div class="line">                .subscribe(<span class="literal">new</span> Action1&lt;<span class="built_in">String</span>&gt;() &#123;</div><div class="line">                    @Override</div><div class="line">                    <span class="keyword">public</span> <span class="literal">void</span> call(<span class="built_in">String</span> s) &#123;</div><div class="line">                        <span class="keyword">Log</span>.w(<span class="built_in">TAG</span>, s);</div><div class="line">                    &#125;</div><div class="line">                &#125;);</div></pre></td></tr></table></figure><p>相信有js经验的人会对 <code>.map</code>这种形式比较熟悉，这里的<code>.map</code>会使每个int 转换成string对象返回。这里又引出了另一个类<code>Func1</code>，<code>FuncX</code>和<code>ActionX</code>的区别在于是否有返回值，X代表是几个参数。</p><ul><li><code>map()</code>事件对象直接对换。示意图如下：</li></ul><p><img src="http://ww1.sinaimg.cn/mw1024/52eb2279jw1f2rx4fitvfj20hw0ea0tg.jpg" alt=""></p><p>这里引出一个比较难理解的方法<code>flatMap()</code>，先来看一个例子：</p><figure class="highlight cs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">Student[] students = ...;</div><div class="line">Subscriber&lt;Course&gt; subscriber = <span class="keyword">new</span> Subscriber&lt;Course&gt;() &#123;</div><div class="line">    @<span class="function">Override</span></div><div class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onNext</span>(<span class="params">Course course</span>) &#123;</div><div class="line">        Log.d(TAG, course.getName());</div><div class="line">    &#125;</div><div class="line">    ...</div><div class="line">&#125;;</div><div class="line">Observable.<span class="keyword">from</span>(students)</div><div class="line">    .flatMap(<span class="keyword">new</span> Func1&lt;Student, Observable&lt;Course&gt;&gt;() &#123;</div><div class="line">        @<span class="function">Override</span></div><div class="line">        <span class="keyword">public</span> Observable&lt;Course&gt; <span class="title">call</span>(<span class="params">Student student</span>) &#123;</div><div class="line">            <span class="keyword">return</span> Observable.<span class="keyword">from</span>(student.getCourses());</div><div class="line">        &#125;</div><div class="line">    &#125;)</div><div class="line">    .subscribe(subscriber);</div></pre></td></tr></table></figure><p>从这个例子中可以看出，<code>flatMap</code>和<code>map</code>一样，都使一个对象转换成另一个对象，但是仔细看会发现，<code>flatMap</code> 返回的是一个 Observable 对象，并且并不是直接放到Subsciber的回调里。</p><p><code>flatMap()</code> 的原理是这样的：</p><ol><li>使用传入的事件对象创建一个 <code>Observable</code>对象；</li><li>并不发送这个 <code>Observable</code>, 而是将它激活，于是它开始发送事件;</li><li>每一个创建出来的 <code>Observable</code> 发送的事件，都被汇入同一个 <code>Observable</code>，而这个 <code>Observable</code> 负责将这些事件统一交给 <code>Subscriber</code> 的回调方法。</li></ol><p>这三个步骤，把事件拆成了两级，通过一组新创建的<code>Observable</code> 将初始的对象『铺平』之后通过统一路径分发了下去。而这个『铺平』就是 <code>flatMap()</code> 所谓的 <code>flat</code>。</p><p><code>flatMap()</code>示意图：<br><img src="http://ww1.sinaimg.cn/mw1024/52eb2279jw1f2rx4i8da2j20hg0dydgx.jpg" alt="图片来自网络"></p><p><code>flatMap()</code>常用于嵌套的异步操作中</p><p>其实还有很多其他的变换方式，这里就不一一说了，他们的共同点在于对世间序列的封装处理和再发送。在RxJava内部，它们都基于一个方法：<code>lift()</code></p><p>前面说到，利用<code>subscribeOn</code>和<code>observeOn</code>来实现线程控制，让事件的产生和消费在不同的线程中。那么，能否多次切换线程呢。答案是可以的。我们通过图开说下两者的原理</p><p><code>subscribeOn()</code> 原理图：<br><img src="http://ww4.sinaimg.cn/mw1024/52eb2279jw1f2rxcynbsuj20ha0d7wg2.jpg" alt=""></p><p><code>observeOn()</code> 原理图：<br><img src="http://ww4.sinaimg.cn/mw1024/52eb2279jw1f2rxd05lttj20hj0cyabl.jpg" alt=""></p><p>从图中可以看出两者线程切换的不同。<code>subscribeOn()</code> 的线程切换发生在 <code>OnSubscribe</code> 中，即在它通知上一级 <code>OnSubscribe</code> 时，这时事件还没有开始发送，因此 <code>subscribeOn()</code> 的线程控制可以从事件发出的开端就造成影响；而 <code>observeOn()</code> 的线程切换则发生在它内建的 <code>Subscriber</code> 中，即发生在它即将给下一级 <code>Subscriber</code> 发送事件时，因此 <code>observeOn()</code> 控制的是它后面的线程。</p><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>由于了解的比较晚，所以只能浅显的说下它的基本用法和原理。现在来说，开源的时代已经来了，所以没事的话，可以多看看其源码。<br>（ps: atlas刚昨天开源，有兴趣的可以去看看 <a href="http://atlas.taobao.org/docs/" target="_blank" rel="external">atlas</a>）</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;自打进入公司以来，一直用的是React Native，以及 React + WebView的结构来写代码，对原生的一些知识学习落后了许多。老是听朋友说什么 RxJava，一脸懵逼。现在，趁闲暇之时，补充下Android知识，在这里简单说下对RxJava的理解。&lt;/p&gt;
&lt;p&gt;在开始之前呢，先要说下其github以及要依赖的包，由于现在 RxJava2已经有了一段时间了，但是对于小白的我来说，还是先从1开始吧。&lt;/p&gt;
&lt;p&gt;GitHub:&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/ReactiveX/RxJava&quot;&gt;https://github.com/ReactiveX/RxJava&lt;/a&gt;&lt;br&gt;&lt;a href=&quot;https://github.com/ReactiveX/RxAndroid&quot;&gt;https://github.com/ReactiveX/RxAndroid&lt;/a&gt;&lt;br&gt;
    
    </summary>
    
    
      <category term="Android" scheme="https://lennyup.github.io/tags/Android/"/>
    
  </entry>
  
  <entry>
    <title>HEXO+Github,搭建自己的个人博客</title>
    <link href="https://lennyup.github.io/2017/03/11/hexo-github/"/>
    <id>https://lennyup.github.io/2017/03/11/hexo-github/</id>
    <published>2017-03-11T09:19:24.000Z</published>
    <updated>2017-10-11T06:15:01.000Z</updated>
    
    <content type="html"><![CDATA[<p>我将这篇文章，作为我的第一篇文章，是为了记录下来自己搭建这个博客的点滴（ps: 方便回忆）。<br>前几天，看见同事在弄这个，于是乎，自己也搭一个玩玩。经过各种查找资料，各种踩坑之后，终于搭建好了hexo，我的hexo是3.2.0版本的。</p><p>之前有想过写博客，一方面是做笔记，俗话说好脑子不如烂笔头嘛，另一方面就是提高自己的总结能力以及表述能力。现在看好多人都用hexo来弄，还有的用的是Jekyll搭的，有需要的可以去搜搜。好了，下面开始上搭建的步骤。<br><a id="more"></a></p><h2 id="配置环境"><a href="#配置环境" class="headerlink" title="配置环境"></a>配置环境</h2><p>安装 Node （*）</p><p>作用：用来生成静态的页面</p><p>node的安装步骤我就不说了，需要的话可以去<a href="https://nodejs.org/en/" target="_blank" rel="external">官网</a>。</p><p>安装 Git（*）</p><p> 作用：把部署的东西提交到github上</p><p> 好了，这两个安装好了之后，我们还需要有一个github的账号。点击上角的加号。</p><p> 点击”New repository”，新建一个版本库</p><p> <img src="https://raw.githubusercontent.com/lennyup/img-warehouse/master/hexo-github1.png" alt=""></p><p> 输入Repository name:yourname.github.io(yourname与你的注册用户名一致,这个就是你博客的域名了)</p><p> <img src="https://raw.githubusercontent.com/lennyup/img-warehouse/master/hexo-github2.png" alt=""></p><p> 创建完版本库之后，如图： 我们要用到它的ssh。到此 github配置久完成了。</p><h2 id="安装Hexo"><a href="#安装Hexo" class="headerlink" title="安装Hexo"></a>安装Hexo</h2><p>首先创建一个文件夹，我这里建的是<code>blog</code>,用户存放hexo配置的文件<br>接下来</p><figure class="highlight elixir"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="variable">$ </span>cd blog</div><div class="line"><span class="variable">$ </span>npm install -g hexo</div></pre></td></tr></table></figure><p> 我用的是npm 你也可以用淘宝的镜像 cnpm， 安装完成之后要对其初始化</p> <figure class="highlight elixir"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="variable">$ </span>hexo init</div></pre></td></tr></table></figure><p> 到此，安装工作就全部完成了，<code>blog</code>就是你以后博客的根目录了。</p><p> 生成静态文件</p> <figure class="highlight verilog"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo <span class="keyword">generate</span> <span class="variable">#(hexo -g  也可以)</span></div></pre></td></tr></table></figure><p> 生成本地服务器</p> <figure class="highlight axapta"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo <span class="keyword">server</span></div></pre></td></tr></table></figure><p> 在浏览器中输入 <code>http://localhost:4000</code>,就可以看到一个初始化的页面了</p><p> <img src="http://7xjzgy.com1.z0.glb.clouddn.com/image/20150701/hexo20150701029.png" alt=""></p><h2 id="配置Github"><a href="#配置Github" class="headerlink" title="配置Github"></a>配置Github</h2><p>我们打来我们之前建的文件 <code>blog</code>可以看到里面的东西：</p><p><img src="https://raw.githubusercontent.com/lennyup/img-warehouse/master/hexo-github3.png" alt=""></p><p>现在我们需要和github建立关联，打开<code>_config.yml</code>文件，到最下面，改成这个样子：</p><figure class="highlight less"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="attribute">deploy</span>:</div><div class="line">     <span class="attribute">type</span>: git</div><div class="line">     <span class="attribute">repo</span>: <span class="attribute">https</span>:<span class="comment">//github.com/lennyup/lennyup.github.io.git</span></div><div class="line">     <span class="attribute">branch</span>: master</div></pre></td></tr></table></figure><p> repo后面是之前我们说过的版本库的ssh，改成自己的就可以了。</p><p> 然后呢，我们需要下载一个关于git的一个插件：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">npm <span class="keyword">install</span> hexo-deployer-git <span class="comment">--save</span></div></pre></td></tr></table></figure><p> 安装完成后，最后一步的命令是：<code>$ hexo deploy</code></p><p>  见证奇迹的时刻来了，在浏览器中输入<a href="https://lennyup.github.io/">https://lennyup.github.io/</a>, 把<code>lennyup</code>换成你自己的账户名就好了。打开后，我们搭建的个人博客就完成了（ps: 简单吗？）<br>每次部署的时候要执行三部：</p><figure class="highlight verilog"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">hexo clean</div><div class="line">hexo <span class="keyword">generate</span></div><div class="line">hexo deploy</div></pre></td></tr></table></figure><p> 在这里，简单说下一些常用的命令</p><figure class="highlight axapta"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">hexo <span class="keyword">new</span><span class="string">"postName"</span> <span class="meta">#新建文章</span></div><div class="line"></div><div class="line">hexo <span class="keyword">new</span> page<span class="string">"pageName"</span> <span class="meta">#新建页面</span></div><div class="line"></div><div class="line">hexo generate <span class="meta">#生成静态页面至public目录</span></div><div class="line"></div><div class="line">hexo <span class="keyword">server</span> <span class="meta">#开启预览访问端口（默认端口4000，'ctrl + c'关闭server）</span></div><div class="line"></div><div class="line">hexo deploy <span class="meta">#将.deploy目录部署到GitHub</span></div><div class="line"></div><div class="line">hexo help <span class="meta"># 查看帮助</span></div><div class="line"></div><div class="line">hexo version <span class="meta">#查看Hexo的版本</span></div></pre></td></tr></table></figure><p> 还有一个主意的点，<code>hexo new &quot;postName</code> 命令之后，可以在我们的<code>blog/source/_post</code>目录下找到我们新的文章，然后用<code>MarkDown</code> 语法来编写你的文章吧，关于<code>MarkDown</code>的语法可以看这里<a href="https://www.zybuluo.com/mdeditor" target="_blank" rel="external">参考一</a></p><h2 id="主题"><a href="#主题" class="headerlink" title="主题"></a>主题</h2><p>大部分主题在这里<a href="https://github.com/hexojs/hexo/wiki/Themes" target="_blank" rel="external">here</a>，<br>里面有详细的使用方法<br>换主题的话在这里，打开<code>_config.yml</code>，找到theme,换成自己想要换的就行了（ps: theme文件里有你要换的主题文件夹）</p><h2 id="修改头像"><a href="#修改头像" class="headerlink" title="修改头像"></a>修改头像</h2><p>打开<code>blog/theme/yourtheme</code>里面有个<code>_config.yml</code>文件，</p><figure class="highlight avrasm"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="symbol">img:</span></div><div class="line">...</div><div class="line"><span class="symbol">avatar:</span></div></pre></td></tr></table></figure><p>把<code>avatar</code>后面的改成自己的就好了</p><h2 id="配置文件简述"><a href="#配置文件简述" class="headerlink" title="配置文件简述"></a>配置文件简述</h2><p>可以看出大多数的修改都是在 <code>blog/_config.yml</code>这个文件。这里简单说下它里面的内容</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#博客名称</span></div><div class="line"><span class="attr">title:</span> <span class="string">我的博客</span></div><div class="line"><span class="comment">#副标题</span></div><div class="line"><span class="attr">subtitle:</span></div><div class="line"><span class="comment">#简介</span></div><div class="line"><span class="attr">description:</span></div><div class="line"><span class="comment">#博客作者</span></div><div class="line"><span class="attr">author:</span> <span class="string">John</span> <span class="string">Doe</span></div><div class="line"><span class="comment">#博客语言</span></div><div class="line"><span class="attr">language:</span> <span class="string">zh-CN</span></div><div class="line"><span class="comment">#时区</span></div><div class="line"><span class="attr">timezone:</span></div><div class="line"></div><div class="line"><span class="comment">#博客地址,与申请的GitHub一致</span></div><div class="line"><span class="attr">url:</span> <span class="attr">http://lennyup.github.io</span></div><div class="line"><span class="attr">root:</span> <span class="string">/</span></div><div class="line"><span class="comment">#博客链接格式</span></div><div class="line"><span class="attr">permalink:</span> <span class="string">:year/:month/:day/:title/</span></div><div class="line"><span class="attr">permalink_defaults:</span></div><div class="line"></div><div class="line"><span class="attr">source_dir:</span> <span class="string">source</span></div><div class="line"><span class="attr">public_dir:</span> <span class="string">public</span></div><div class="line"><span class="attr">tag_dir:</span> <span class="string">tags</span></div><div class="line"><span class="attr">archive_dir:</span> <span class="string">archives</span></div><div class="line"><span class="attr">category_dir:</span> <span class="string">categories</span></div><div class="line"><span class="attr">code_dir:</span> <span class="string">downloads/code</span></div><div class="line"><span class="attr">i18n_dir:</span> <span class="string">:lang</span></div><div class="line"><span class="attr">skip_render:</span></div><div class="line"></div><div class="line"><span class="attr">new_post_name:</span> <span class="string">:title.md</span> <span class="comment"># File name of new posts</span></div><div class="line"><span class="attr">default_layout:</span> <span class="string">post</span></div><div class="line"><span class="attr">titlecase:</span> <span class="literal">false</span> <span class="comment"># Transform title into titlecase</span></div><div class="line"><span class="attr">external_link:</span> <span class="literal">true</span> <span class="comment"># Open external links in new tab</span></div><div class="line"><span class="attr">filename_case:</span> <span class="number">0</span></div><div class="line"><span class="attr">render_drafts:</span> <span class="literal">false</span></div><div class="line"><span class="attr">post_asset_folder:</span> <span class="literal">false</span></div><div class="line"><span class="attr">relative_link:</span> <span class="literal">false</span></div><div class="line"><span class="attr">future:</span> <span class="literal">true</span></div><div class="line"><span class="attr">highlight:</span></div><div class="line"><span class="attr">  enable:</span> <span class="literal">true</span></div><div class="line"><span class="attr">  line_number:</span> <span class="literal">true</span></div><div class="line"><span class="attr">  auto_detect:</span> <span class="literal">true</span></div><div class="line"><span class="attr">  tab_replace:</span></div><div class="line"></div><div class="line"><span class="attr">default_category:</span> <span class="string">uncategorized</span></div><div class="line"><span class="attr">category_map:</span></div><div class="line"><span class="attr">tag_map:</span></div><div class="line"></div><div class="line"><span class="comment">#日期格式</span></div><div class="line"><span class="attr">date_format:</span> <span class="string">YYYY-MM-DD</span></div><div class="line"><span class="attr">time_format:</span> <span class="attr">HH:mm:ss</span></div><div class="line"></div><div class="line"><span class="comment">#分页，每页文章数量</span></div><div class="line"><span class="attr">per_page:</span> <span class="number">10</span></div><div class="line"><span class="attr">pagination_dir:</span> <span class="string">page</span></div><div class="line"></div><div class="line"><span class="comment">#博客主题</span></div><div class="line"><span class="attr">theme:</span> <span class="string">landscape</span></div><div class="line"></div><div class="line"><span class="comment">#发布设置</span></div><div class="line"><span class="attr">deploy:</span></div><div class="line"><span class="attr">  type:</span> <span class="string">git</span></div><div class="line">  <span class="comment">#lennyup改为你的github用户名</span></div><div class="line"><span class="attr">  repository:</span> <span class="attr">https://github.com/lennyup/lennyup.github.io.git</span></div><div class="line"><span class="attr">  branch:</span> <span class="string">master</span></div></pre></td></tr></table></figure><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>到此，基本的一些内容已经介绍完了，关于主题的一些更炫酷的设置，就要看响应主题的使用了。</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;我将这篇文章，作为我的第一篇文章，是为了记录下来自己搭建这个博客的点滴（ps: 方便回忆）。&lt;br&gt;前几天，看见同事在弄这个，于是乎，自己也搭一个玩玩。经过各种查找资料，各种踩坑之后，终于搭建好了hexo，我的hexo是3.2.0版本的。&lt;/p&gt;
&lt;p&gt;之前有想过写博客，一方面是做笔记，俗话说好脑子不如烂笔头嘛，另一方面就是提高自己的总结能力以及表述能力。现在看好多人都用hexo来弄，还有的用的是Jekyll搭的，有需要的可以去搜搜。好了，下面开始上搭建的步骤。&lt;br&gt;
    
    </summary>
    
    
      <category term="hexo" scheme="https://lennyup.github.io/tags/hexo/"/>
    
  </entry>
  
</feed>
